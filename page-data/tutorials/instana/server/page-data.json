{"componentChunkName":"component---src-pages-tutorials-instana-server-index-mdx","path":"/tutorials/instana/server/","result":{"pageContext":{"frontmatter":{"title":"1 - Instana Server Installation","description":"How to install the Instana Server on a single server Self-Hosted configuration"},"relativePagePath":"/tutorials/instana/server/index.mdx","titleType":"page","MdxNode":{"id":"34726164-cc90-5e44-aef3-0655d6564986","children":[],"parent":"7cc80fe7-ed5f-52d9-adc3-ddf4a23d358a","internal":{"content":"---\r\ntitle: 1 - Instana Server Installation\r\ndescription: How to install the Instana Server on a single server Self-Hosted configuration\r\n---\r\n\r\n<AnchorLinks>\r\n  <AnchorLink>2-1: Introduction</AnchorLink>\r\n  <AnchorLink>2-2: Prerequisites</AnchorLink>\r\n  <AnchorLink>2-3: Install Instana Server</AnchorLink>\r\n  <AnchorLink>2-4: Activate the License</AnchorLink>\r\n  <AnchorLink>2-5: Launch the Instana User Interface</AnchorLink>\r\n  <AnchorLink>2-6: Turning on features and setting up SMTP</AnchorLink>\r\n  <AnchorLink>2-7: Upgrading the Instana Server</AnchorLink>\r\n  <AnchorLink>2-8: Summary</AnchorLink>\r\n</AnchorLinks>\r\n\r\n## 2-1:  Introduction\r\nInstana backand is available as SaaS (prefered option) or self hosted (aka onPrem). For on-premises installation, Instana offers multiple options:\r\n- Single Server **self-hosted** is a Dockerized deployment that does not support multi-tenancy.  Self-Hosted is what Instana calls its on-premise deployments.  Of course, on-premise could be deployed into a public cloud, but is not a \r\n- Two server Dockerized **self-hosted** configuration with the datastores on one server and the other components on another. This option is also single-tenant.\r\n- Small scale kubernetes deployment with the cloud native components running in a kubernetes cluster and the datastores running on a Docker host.  This configuration is multi-tenant.\r\n- Large scale kubernetes deployments run the cloud native portion in kubernetes and the datastores distributed across multiple servers.  For assistance with architecture/planning, \r\n  contact the SWAT team or open a [SWAT Request](http://ibm.biz/automation-swat) request.\r\n- OpenShift support is currently in Tech Preview.\r\n\r\nFor informational purposes, on-prem (self-hosted) releases are delivered every 4 weeks.   The release have odd numbers such as 225, 227, 229, etc.  When upgrading, you may upgrade from N-1 or N-2, but you can't skip more than one release.  So, you can upgrade from 225 to 229, but not to 231.  Even numbered releases are for SaaS only.  SaaS is upgraded every 2 weeks.\r\n\r\nYou will be performing and on-line installation during this Tech Jam, but Instana does support off-line (air-gapped) installs.\r\n\r\n## 2-2:  Prerequisites\r\n\r\nFor the installation of the Instana server, we'll be following the instructions layed out in the Instana documentation for a **Self-Hosted Instana backend on Docker**\r\nThe instructions can be found here for your reference, but you can follow the steps below.  \r\nhttps://www.ibm.com/docs/en/instana-observability/current?topic=instana-self-hosted-backend-docker-premises \r\n\r\nThis is Instana's smallest on-premise installation option.  Production and larger deployments are installed into kubernetes for horizontal scale and resiliency.\r\n\r\nFor the lab, you were assigned a virtual machine labeled the **control node**.  From a terminal window, ssh into the control using the id_rsa file that you previously downloaded as shown.   Replace <IP address of the control node\\> with your control node IP address:\r\n```sh\r\nssh -i id_rsa jammer@<IP address of control node>\r\n\r\n```\r\n\r\nOnce you are logged onto the control node, ssh to the Instana server by issuing the following command:\r\n```sh\r\nssh jammer@instana\r\n\r\n```\r\n\r\nOnce you are logged onto the Instana server node, use sudo to become root.\r\n```sh\r\nsudo -i\r\n\r\n```\r\n\r\n\r\nInstana has a few prereqs for installing the server.  Some of those have been setup for you.  Others, you will need to perform the installation.  For example, the firewall ports required \r\nfor Agent, UI, and EUM communications have already been configured in the OS firewall.  \r\n\r\nInstana requires a Linux server with 16 cores, 64 Gig of RAM and few hundred Gig of disk space for a POC sized deployment. It also requires fast backend storage.  For environments\r\nwith even a few hundred servrs, you'll need 6000 IOPS or more.  For larger deployments, you'll need more capacity.\r\nSeveral different versions of Linux are supported.  We have chosen Ubuntu 20.04 for this environment.   \r\n\r\nPrior to installing Instana, you must install Docker CE or Docker EE.  Run the following commands to setup the prereqs, download Docker CE, and install Docker CE on the virtual machine. \r\n\r\n ```sh\r\napt-get install ca-certificates curl gnupg lsb-release -y\r\n```\r\n```sh\r\nmkdir -p /etc/apt/keyrings\r\n```\r\n```sh\r\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\r\n```\r\n```sh\r\necho   \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\r\n```\r\n```sh\r\napt-get update -y\r\n```\r\n```sh\r\napt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin -y\r\n ```\r\n\r\nAfter the commands have executed, verify that docker is installed and running.  You can issue **docker ps** command to confirm that it is installed and running.  If docker is running, you should see output similar to what's shown below.\r\n![](images/docker.png)\r\n\r\nNext, we want to pin the major version of Instana so that we don't get updates during the lab.\r\nIssue the following command to pin the Instana version.\r\n\r\n```sh\r\ncat >/etc/apt/preferences.d/instana-console <<EOF\r\nPackage: instana-console\r\nPin: version 231-1\r\nPin-Priority: 1000\r\nEOF\r\n\r\n```  \r\n\r\nNext, create the following directories and/or filesystems that will be used for the Instana datastores (/mnt/metrics, /mnt/traces, /mnt/data).  Ideally, these directories/filesystems should be setup on fast storage volumes with a separate filesystem for each because the datastores are very I/O intensive.  Even during a POC, these filesystems can become fairly large.  Plan for a minimum of 20 Gig for the **data** directory, 200 Gig for the **metrics** directory, and 40 Gig for the **traces** directory.  Production environments will be much larger and need to be planned for based on the size of the environment.\r\n```sh\r\nmkdir /mnt/metrics\r\nmkdir /mnt/traces\r\nmkdir /mnt/data\r\n\r\n```\r\n\r\nNormally, you would also need to ensure that the virtual machine has the correct ports opened in the firewall.  We have already done this work for you.  For reference, here are the \r\nports that need to be opened for the Instana Server for an on-prem deployment.  The ports for SaaS are slightly different.\r\nhttps://www.ibm.com/docs/en/instana-observability/current?topic=premises-installing-instana-backend-docker#network-security-notes\r\n\r\n\r\nYou are now ready to start the installation of the Instana Server.\r\n\r\n\r\n***\r\n\r\n## 2-3:  Installing Instana Server\r\n\r\nRun the following commands to install the Instana Server.  These commands will vary depending on which Linux platform you are using for your installation.  The instructions below are for Ubuntu and Debian.\r\n\r\nBegin by installing the Instana package by issuing the following commands. Make sure the command is successful before proceding to the next command.\r\n```sh\r\necho \"deb [arch=amd64] https://self-hosted.instana.io/apt generic main\" > /etc/apt/sources.list.d/instana-product.list\r\n```\r\n```sh\r\nwget -qO - \"https://self-hosted.instana.io/signing_key.gpg\" | apt-key add -\r\n```\r\n```sh\r\napt-get update -y\r\n```\r\n```sh\r\napt-get upgrade -y\r\n```\r\n```sh\r\napt-get install instana-console -y\r\n```\r\n\r\nThis will install the \"instana\" command on the server.\r\n\r\nNow let's create the working directory for instana server installation:\r\n```sh\r\nmkdir -p /opt/instana && cd /opt/instana\r\n```\r\nNext, run the **instana init** command to install the Instana server.  You will be prompted for additional information during the install.\r\n\r\n```sh\r\ninstana init\r\n```\r\n\r\nWhen you run the **instana init** command, it generates a file named settings.hcl in your current directory.  It is important to save this file.  The settings.hcl file contains the configuration settings for your deployment.  It can be used to enable additional features and make other configuration settings in the future.\r\n\r\nYou will be prompted to select **single**, **dual-instana**, or **dual-clickhouse**.  Type **Enter** to select **single**\r\n![](images/single.png)\r\n\r\nNext, you will be prompted to enter a tenant name for your Instana server.  This can be any string.  In a single server installation, the tenant name doesn't really matter, but in\r\nmulti-tenant or SaaS environment, the tenant name is very important because it becomes part of the URL to access the Instana server.  Customers frequently use their company name for the tenant.\r\n![](images/tenant.png)\r\n\r\nNext, you will be prompted to enter a unit name. In a single server installation, the unit name doesn't really matter, but in multi-tenant or SaaS environment,\r\nthe unit name is very important because it becomes part of the URL to access the Instana server.  Customers frequently use a business unit or Dev, Test, Prod to identify the unit.\r\n![](images/unit.png)\r\n\r\nYou will now be prompted for your **agent key**.  This will be provided to you by the lab proctors.\r\n![](images/agentKey.png)\r\n\r\nThe next step is to enter your **download key**.  Use the same key as your **agent key** from the previous step.\r\n![](images/downloadKey.png)\r\n\r\nNext, enter your **sales key**.  This will be provided to you by the lab proctors.\r\n![](images/salesKey.png)\r\n\r\nNext, you will be prompted for the fully qualified hostname of the server.  Normally, you would enter a fully qualified hostname, but these servers are not in DNS. \r\n\r\n<span style=\"color:red\"> Instead of specifying the hostname, enter the **IP address** of the Instana server. </span>\r\n\r\nIf you are not sure what the IP address is, you cat the /etc/hosts file and find the instana hostname and IP address.\r\n\r\n![](images/hostname.png)\r\n\r\nYou will now be prompted for the path where your data will be stored.  The default path is /mnt/data.  Press **Enter** to accept the default value.\r\n![](images/data.png)\r\n\r\nYou will now be prompted for the path where your traces will be stored.  The default path is /mnt/traces.  Press **Enter** to accept the default value.\r\n![](images/traces.png)\r\n\r\nNext, you will be prompted for the path where your metric data will be stored.  The default path is /mnt/metrics.  Press **Enter** to accept the default value.\r\n![](images/metrics.png)\r\n\r\nYou will be prompted for the location of the Instana logs.  Press **Enter** to accept the default value of /var/log/instana.\r\n![](images/logs.png)\r\n\r\nFinally, you will be prompted for the path to your signed certificate file.  If desired, you can create your own.  If you don't provide one, the installer will generate a certificate.\r\nPress **Enter** and let Instana generate a self-signed certificate.  If you were deploying at a customer site and the customer wanted to user CA signed certificates, this is the step where you would specify the existing certificate.\r\n![](images/certificate.png)\r\n\r\nYou will be prompted for the private key file. For this lab, press **Enter** and have the install generate the key file for the self-signed certificate.\r\n![](images/key.png)\r\n\r\nInstana will now begin the installation process.  It will take 20 to 30 minutes to complete the installation process.\r\n\r\nAt the end of the installation, you will be shown the URL to access the Instana server and a username of **admin@instana.local** and a **password**.   Save this information so that you can use it later to login to the Instana user interface.\r\n\r\nThe output should look something like this:\r\n![](images/installSuccess.png)\r\n\r\nIf you forget the password, you can use the following command to reset the admin@instana.local password:   **instana configure admin -p <password for admin\\>**\r\n\r\nBefore attempting to login to your Instana server, activate the license using the steps in section 2-4.\r\n\r\n***\r\n\r\n## 2-4:  Activate the license\r\n\r\nAfter completing the installation, you must activate the license.\r\nWe suggest you run the following commands in your working directory hence the license file will store here:\r\n```sh\r\ncd /opt/instana\r\n```\r\n\r\nRun the following command to download the license:\r\n```sh\r\ninstana license download\r\n```\r\n![](images/licenseDownload_opt_instana.png)\r\n\r\nNext, import the license to activate your license:\r\n```sh\r\ninstana license import\r\n```\r\n![](images/licenseImport_opt_instana.png)\r\n\r\nYou can verify the license by typing:\r\n```sh\r\ninstana license verify\r\n``` \r\n![](images/licenseVerify_opt_instana.png)\r\n\r\n\r\n***\r\n\r\n## 2-5:  Launch the Instana User interface\r\n\r\nYou are now ready to open a browser and login to the Instana user interface.\r\n\r\nOpen a firefox browser.  Other browsers can be used, but you would need to setup the server as a trusted URL due to the self-signed certificate.\r\n\r\nEnter an HTTPS URL with the IP address of the Instana server.  You would have seen this URL at the end of step 2-3.  Example:   https://\\<IP address\\>\r\n\r\nWhen prompted, enter the username and password that you saved earlier.  The username is **admin@instana.local**\r\n![](images/login.png)\r\n\r\nYou will be taken to an Initial Screen where you can install the instana agents or navigate to the main product UI.  We will perform these steps in another section of the lab.\r\n![](images/initialScreen.png)\r\n***\r\n\r\n## 2-6:  Turning on features and setting up SMTP\r\n\r\nFollowing the initial install of your Instana server, there are optional configurations that you will likely want to make.  First, you need to setup the Instana server to use an SMTP server if you plan to send out Email notifications.  Second, there may be some optional features that you want to enable via feature flags.  Features such as VMware/vSphere monitoring, Power HMC monitoring, and zHMC monitoring are disabled by default. \r\n\r\nFollow the steps below to configure the SMTP settings and enable some additional feature flags.\r\n\r\n1. Edit `settings.hcl` file according to the [documentation](https://www.ibm.com/docs/en/obi/current?topic=installer-enabling-feature-flags). The **settings.hcl** file will be located in the same directory where you issued the **instana init** command.  \r\n\r\nThese parameters are added to the settings.hcl file in the section with the other feature flags.  Search in the settings.hcl file for **feature**.  Then, add any additional feature flags that are desired in that section of the file.  They can be place anywhere within the **feature** section of the file.\r\n\r\n> **WARNING: Be aware that turning on features (especially BETA ones) may heavily impact backend performance. DO NOT turn on features you don't need**\r\n\r\nAs we issued **instana init** from the working directory `/opt/instana`, the `settings.hcl` has been created there:\r\n```sh\r\ncd /opt/instana\r\n```\r\n\r\nBefore using vi to edit the settings.hcl file, make a backup of the file by typing:  \r\n```sh\r\ncp settings.hcl settings.hcl.bak\r\n```\r\n\r\nIn your lab enviroment, we want you to add the following feature flags.\r\n```yaml\r\nfeature \"infraCustomDashboards\" {\r\n  enabled = true\r\n}\r\nfeature \"infraEntityExplore\" {\r\n  enabled = true\r\n}\r\n```\r\n\r\nNote:  There are other feature flags that you should be aware of, <span style=\"color:red\"> but do not add these into the settings.hcl file</span>.  Here are some common feature flags available are:\r\n\r\n```yaml\r\nfeature \"vsphereEnabled\" {\r\n  enabled=true\r\n}\r\nfeature \"zhmcEnabled\" {\r\n  enabled=true\r\n}\r\nfeature \"phmcEnabled\" {\r\n  enabled=true\r\n}\r\nfeature \"beeinstana\" {\r\n  enabled=true\r\n}\r\nfeature \"smartAlertsLogsBlueprintEnabled\" {\r\n  enabled=true\r\n}\r\nfeature \"infraCustomDashboards\" {\r\n  enabled = true\r\n}\r\nfeature \"infraEntityExplore\" {\r\n  enabled = true\r\n}\r\n```\r\n\r\nNext, search for the **smtp** section in the settings.hcl file.   Modify the smtp section to look something like this.  We recommend that you edit the paramters rather than copy/paste this section.  It is easy to make a mistake with the spacing when doing a copy/paste.\r\n```sh\r\n  smtp {\r\n    from      = \"server@instana.com\"\r\n    host      = \"localhost\"\r\n    port      = 25\r\n    user      = \"jammer\"\r\n    password  = \"<jammer password provided by proctors>\"\r\n    use_ssl   = false\r\n    start_tls = false\r\n  }\r\n  ```\r\n\r\nReplace **<jammer password\\>** with the jammer password of the Instana server that was provided by the lab proctors.  If you want, you can replace the **from** parameter with any Email address that you like.  The **from** Email address is what you will see as the sender of the Email alerts from Instana.  All of the rest of the parameters should match what you see on the screen.\r\n\r\nSave the changes in the settings.hcl file.\r\n\r\n2. Run `instana update -f ./settings.hcl` to apply changes.\r\n```sh\r\ninstana update -f ./settings.hcl\r\n\r\n```\r\n\r\nIt will take a little while for the configuration changes to take effect.  Read section 1-7 while the configuration changes are being applied.\r\n\r\n***\r\n\r\n## 2-7:  Upgrading the Instana server\r\n\r\n<span style=\"color:red\">Do NOT perform these steps. But we want you to know the process for performing an upgrade.</span>\r\n  \r\n\r\nWhen upgrading an Instana server, it is important to know that you can only skip one release when upgrading.  The on-prem/self-hosted releases use odd numbers.  That means that you can upgrade from version 225 to either 227 or 229.  But, you can't upgrade from 225 to 231 because that would be skipping 2 releases and isn't supported.  It is important for customers to know this because they need to keep their Instana server patched on a fairly regular basis. Otherwise, it will mean that they will have to perform multiple steps to upgrade to the current version.\r\n\r\nBefore attempting to upgrade, you want to confirm your current version.  Issue the **instana version**\r\n```sh\r\ninstana version\r\n```\r\n\r\nNext, find out what versions are available to be installed.   Issue the the following command:\r\n```sh\r\napt-cache policy instana-console\r\n```\r\n\r\nYou will see a long list of versions that are available.  Scroll to the top of the list where you will see the most recent versions.\r\n![](images/versions.png)\r\n\r\nYou'll notice that in this example, 229-2 is the most recent version and 229-1 is the current version.  That means you can upgrade to that minor release.  There is newer major release available.\r\n\r\nFirst, install the latest instana-console.  This upgrades the **instana** command that is installed on your server:\r\n```sh\r\napt install instana-console=229-2\r\n```\r\n\r\nNext, upgrade the server by issuing the **instana update** command.  If you are in directory with the settings.hcl file, then you don't need any arguments.  Otherwise, specify the path to the settings.hcl file.\r\n```sh\r\ninstana update -f /opt/instana/settings.hcl\r\n```\r\nWhen performance the upgrade, the installer automatically pulls down the latest docker containers and gets them up and running on the Instana server.\r\n\r\n\r\n***\r\n\r\n\r\n## 2-8:  Summary\r\n\r\nIn this portion of the lab, you have learned how to install a self-hosted docker based Instana server.  For a POC, we recommend either SaaS or the single server self-hosted docker installation of the Instana server.  For production deployments, customers will want the kubernetes based deployments to gain improved scalability and resiliency.\r\n\r\nYou have also learned how to configure the SMTP settings and how to enable feature flags.\r\n\r\nFinally, you learned how to upgrade a docker based self-hosted Instana server.\r\n\r\nYou are now ready to continue with other portions of the lab.    Navigate to section 3 of the Instana lab.\r\n\r\n***\r\n\r\n\r\n\r\n\r\n\r\n\r\n","type":"Mdx","contentDigest":"5aefb6ee9be5ced4bb05aa361a8b40c3","owner":"gatsby-plugin-mdx","counter":1337},"frontmatter":{"title":"1 - Instana Server Installation","description":"How to install the Instana Server on a single server Self-Hosted configuration"},"exports":{},"rawBody":"---\r\ntitle: 1 - Instana Server Installation\r\ndescription: How to install the Instana Server on a single server Self-Hosted configuration\r\n---\r\n\r\n<AnchorLinks>\r\n  <AnchorLink>2-1: Introduction</AnchorLink>\r\n  <AnchorLink>2-2: Prerequisites</AnchorLink>\r\n  <AnchorLink>2-3: Install Instana Server</AnchorLink>\r\n  <AnchorLink>2-4: Activate the License</AnchorLink>\r\n  <AnchorLink>2-5: Launch the Instana User Interface</AnchorLink>\r\n  <AnchorLink>2-6: Turning on features and setting up SMTP</AnchorLink>\r\n  <AnchorLink>2-7: Upgrading the Instana Server</AnchorLink>\r\n  <AnchorLink>2-8: Summary</AnchorLink>\r\n</AnchorLinks>\r\n\r\n## 2-1:  Introduction\r\nInstana backand is available as SaaS (prefered option) or self hosted (aka onPrem). For on-premises installation, Instana offers multiple options:\r\n- Single Server **self-hosted** is a Dockerized deployment that does not support multi-tenancy.  Self-Hosted is what Instana calls its on-premise deployments.  Of course, on-premise could be deployed into a public cloud, but is not a \r\n- Two server Dockerized **self-hosted** configuration with the datastores on one server and the other components on another. This option is also single-tenant.\r\n- Small scale kubernetes deployment with the cloud native components running in a kubernetes cluster and the datastores running on a Docker host.  This configuration is multi-tenant.\r\n- Large scale kubernetes deployments run the cloud native portion in kubernetes and the datastores distributed across multiple servers.  For assistance with architecture/planning, \r\n  contact the SWAT team or open a [SWAT Request](http://ibm.biz/automation-swat) request.\r\n- OpenShift support is currently in Tech Preview.\r\n\r\nFor informational purposes, on-prem (self-hosted) releases are delivered every 4 weeks.   The release have odd numbers such as 225, 227, 229, etc.  When upgrading, you may upgrade from N-1 or N-2, but you can't skip more than one release.  So, you can upgrade from 225 to 229, but not to 231.  Even numbered releases are for SaaS only.  SaaS is upgraded every 2 weeks.\r\n\r\nYou will be performing and on-line installation during this Tech Jam, but Instana does support off-line (air-gapped) installs.\r\n\r\n## 2-2:  Prerequisites\r\n\r\nFor the installation of the Instana server, we'll be following the instructions layed out in the Instana documentation for a **Self-Hosted Instana backend on Docker**\r\nThe instructions can be found here for your reference, but you can follow the steps below.  \r\nhttps://www.ibm.com/docs/en/instana-observability/current?topic=instana-self-hosted-backend-docker-premises \r\n\r\nThis is Instana's smallest on-premise installation option.  Production and larger deployments are installed into kubernetes for horizontal scale and resiliency.\r\n\r\nFor the lab, you were assigned a virtual machine labeled the **control node**.  From a terminal window, ssh into the control using the id_rsa file that you previously downloaded as shown.   Replace <IP address of the control node\\> with your control node IP address:\r\n```sh\r\nssh -i id_rsa jammer@<IP address of control node>\r\n\r\n```\r\n\r\nOnce you are logged onto the control node, ssh to the Instana server by issuing the following command:\r\n```sh\r\nssh jammer@instana\r\n\r\n```\r\n\r\nOnce you are logged onto the Instana server node, use sudo to become root.\r\n```sh\r\nsudo -i\r\n\r\n```\r\n\r\n\r\nInstana has a few prereqs for installing the server.  Some of those have been setup for you.  Others, you will need to perform the installation.  For example, the firewall ports required \r\nfor Agent, UI, and EUM communications have already been configured in the OS firewall.  \r\n\r\nInstana requires a Linux server with 16 cores, 64 Gig of RAM and few hundred Gig of disk space for a POC sized deployment. It also requires fast backend storage.  For environments\r\nwith even a few hundred servrs, you'll need 6000 IOPS or more.  For larger deployments, you'll need more capacity.\r\nSeveral different versions of Linux are supported.  We have chosen Ubuntu 20.04 for this environment.   \r\n\r\nPrior to installing Instana, you must install Docker CE or Docker EE.  Run the following commands to setup the prereqs, download Docker CE, and install Docker CE on the virtual machine. \r\n\r\n ```sh\r\napt-get install ca-certificates curl gnupg lsb-release -y\r\n```\r\n```sh\r\nmkdir -p /etc/apt/keyrings\r\n```\r\n```sh\r\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\r\n```\r\n```sh\r\necho   \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\r\n```\r\n```sh\r\napt-get update -y\r\n```\r\n```sh\r\napt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin -y\r\n ```\r\n\r\nAfter the commands have executed, verify that docker is installed and running.  You can issue **docker ps** command to confirm that it is installed and running.  If docker is running, you should see output similar to what's shown below.\r\n![](images/docker.png)\r\n\r\nNext, we want to pin the major version of Instana so that we don't get updates during the lab.\r\nIssue the following command to pin the Instana version.\r\n\r\n```sh\r\ncat >/etc/apt/preferences.d/instana-console <<EOF\r\nPackage: instana-console\r\nPin: version 231-1\r\nPin-Priority: 1000\r\nEOF\r\n\r\n```  \r\n\r\nNext, create the following directories and/or filesystems that will be used for the Instana datastores (/mnt/metrics, /mnt/traces, /mnt/data).  Ideally, these directories/filesystems should be setup on fast storage volumes with a separate filesystem for each because the datastores are very I/O intensive.  Even during a POC, these filesystems can become fairly large.  Plan for a minimum of 20 Gig for the **data** directory, 200 Gig for the **metrics** directory, and 40 Gig for the **traces** directory.  Production environments will be much larger and need to be planned for based on the size of the environment.\r\n```sh\r\nmkdir /mnt/metrics\r\nmkdir /mnt/traces\r\nmkdir /mnt/data\r\n\r\n```\r\n\r\nNormally, you would also need to ensure that the virtual machine has the correct ports opened in the firewall.  We have already done this work for you.  For reference, here are the \r\nports that need to be opened for the Instana Server for an on-prem deployment.  The ports for SaaS are slightly different.\r\nhttps://www.ibm.com/docs/en/instana-observability/current?topic=premises-installing-instana-backend-docker#network-security-notes\r\n\r\n\r\nYou are now ready to start the installation of the Instana Server.\r\n\r\n\r\n***\r\n\r\n## 2-3:  Installing Instana Server\r\n\r\nRun the following commands to install the Instana Server.  These commands will vary depending on which Linux platform you are using for your installation.  The instructions below are for Ubuntu and Debian.\r\n\r\nBegin by installing the Instana package by issuing the following commands. Make sure the command is successful before proceding to the next command.\r\n```sh\r\necho \"deb [arch=amd64] https://self-hosted.instana.io/apt generic main\" > /etc/apt/sources.list.d/instana-product.list\r\n```\r\n```sh\r\nwget -qO - \"https://self-hosted.instana.io/signing_key.gpg\" | apt-key add -\r\n```\r\n```sh\r\napt-get update -y\r\n```\r\n```sh\r\napt-get upgrade -y\r\n```\r\n```sh\r\napt-get install instana-console -y\r\n```\r\n\r\nThis will install the \"instana\" command on the server.\r\n\r\nNow let's create the working directory for instana server installation:\r\n```sh\r\nmkdir -p /opt/instana && cd /opt/instana\r\n```\r\nNext, run the **instana init** command to install the Instana server.  You will be prompted for additional information during the install.\r\n\r\n```sh\r\ninstana init\r\n```\r\n\r\nWhen you run the **instana init** command, it generates a file named settings.hcl in your current directory.  It is important to save this file.  The settings.hcl file contains the configuration settings for your deployment.  It can be used to enable additional features and make other configuration settings in the future.\r\n\r\nYou will be prompted to select **single**, **dual-instana**, or **dual-clickhouse**.  Type **Enter** to select **single**\r\n![](images/single.png)\r\n\r\nNext, you will be prompted to enter a tenant name for your Instana server.  This can be any string.  In a single server installation, the tenant name doesn't really matter, but in\r\nmulti-tenant or SaaS environment, the tenant name is very important because it becomes part of the URL to access the Instana server.  Customers frequently use their company name for the tenant.\r\n![](images/tenant.png)\r\n\r\nNext, you will be prompted to enter a unit name. In a single server installation, the unit name doesn't really matter, but in multi-tenant or SaaS environment,\r\nthe unit name is very important because it becomes part of the URL to access the Instana server.  Customers frequently use a business unit or Dev, Test, Prod to identify the unit.\r\n![](images/unit.png)\r\n\r\nYou will now be prompted for your **agent key**.  This will be provided to you by the lab proctors.\r\n![](images/agentKey.png)\r\n\r\nThe next step is to enter your **download key**.  Use the same key as your **agent key** from the previous step.\r\n![](images/downloadKey.png)\r\n\r\nNext, enter your **sales key**.  This will be provided to you by the lab proctors.\r\n![](images/salesKey.png)\r\n\r\nNext, you will be prompted for the fully qualified hostname of the server.  Normally, you would enter a fully qualified hostname, but these servers are not in DNS. \r\n\r\n<span style=\"color:red\"> Instead of specifying the hostname, enter the **IP address** of the Instana server. </span>\r\n\r\nIf you are not sure what the IP address is, you cat the /etc/hosts file and find the instana hostname and IP address.\r\n\r\n![](images/hostname.png)\r\n\r\nYou will now be prompted for the path where your data will be stored.  The default path is /mnt/data.  Press **Enter** to accept the default value.\r\n![](images/data.png)\r\n\r\nYou will now be prompted for the path where your traces will be stored.  The default path is /mnt/traces.  Press **Enter** to accept the default value.\r\n![](images/traces.png)\r\n\r\nNext, you will be prompted for the path where your metric data will be stored.  The default path is /mnt/metrics.  Press **Enter** to accept the default value.\r\n![](images/metrics.png)\r\n\r\nYou will be prompted for the location of the Instana logs.  Press **Enter** to accept the default value of /var/log/instana.\r\n![](images/logs.png)\r\n\r\nFinally, you will be prompted for the path to your signed certificate file.  If desired, you can create your own.  If you don't provide one, the installer will generate a certificate.\r\nPress **Enter** and let Instana generate a self-signed certificate.  If you were deploying at a customer site and the customer wanted to user CA signed certificates, this is the step where you would specify the existing certificate.\r\n![](images/certificate.png)\r\n\r\nYou will be prompted for the private key file. For this lab, press **Enter** and have the install generate the key file for the self-signed certificate.\r\n![](images/key.png)\r\n\r\nInstana will now begin the installation process.  It will take 20 to 30 minutes to complete the installation process.\r\n\r\nAt the end of the installation, you will be shown the URL to access the Instana server and a username of **admin@instana.local** and a **password**.   Save this information so that you can use it later to login to the Instana user interface.\r\n\r\nThe output should look something like this:\r\n![](images/installSuccess.png)\r\n\r\nIf you forget the password, you can use the following command to reset the admin@instana.local password:   **instana configure admin -p <password for admin\\>**\r\n\r\nBefore attempting to login to your Instana server, activate the license using the steps in section 2-4.\r\n\r\n***\r\n\r\n## 2-4:  Activate the license\r\n\r\nAfter completing the installation, you must activate the license.\r\nWe suggest you run the following commands in your working directory hence the license file will store here:\r\n```sh\r\ncd /opt/instana\r\n```\r\n\r\nRun the following command to download the license:\r\n```sh\r\ninstana license download\r\n```\r\n![](images/licenseDownload_opt_instana.png)\r\n\r\nNext, import the license to activate your license:\r\n```sh\r\ninstana license import\r\n```\r\n![](images/licenseImport_opt_instana.png)\r\n\r\nYou can verify the license by typing:\r\n```sh\r\ninstana license verify\r\n``` \r\n![](images/licenseVerify_opt_instana.png)\r\n\r\n\r\n***\r\n\r\n## 2-5:  Launch the Instana User interface\r\n\r\nYou are now ready to open a browser and login to the Instana user interface.\r\n\r\nOpen a firefox browser.  Other browsers can be used, but you would need to setup the server as a trusted URL due to the self-signed certificate.\r\n\r\nEnter an HTTPS URL with the IP address of the Instana server.  You would have seen this URL at the end of step 2-3.  Example:   https://\\<IP address\\>\r\n\r\nWhen prompted, enter the username and password that you saved earlier.  The username is **admin@instana.local**\r\n![](images/login.png)\r\n\r\nYou will be taken to an Initial Screen where you can install the instana agents or navigate to the main product UI.  We will perform these steps in another section of the lab.\r\n![](images/initialScreen.png)\r\n***\r\n\r\n## 2-6:  Turning on features and setting up SMTP\r\n\r\nFollowing the initial install of your Instana server, there are optional configurations that you will likely want to make.  First, you need to setup the Instana server to use an SMTP server if you plan to send out Email notifications.  Second, there may be some optional features that you want to enable via feature flags.  Features such as VMware/vSphere monitoring, Power HMC monitoring, and zHMC monitoring are disabled by default. \r\n\r\nFollow the steps below to configure the SMTP settings and enable some additional feature flags.\r\n\r\n1. Edit `settings.hcl` file according to the [documentation](https://www.ibm.com/docs/en/obi/current?topic=installer-enabling-feature-flags). The **settings.hcl** file will be located in the same directory where you issued the **instana init** command.  \r\n\r\nThese parameters are added to the settings.hcl file in the section with the other feature flags.  Search in the settings.hcl file for **feature**.  Then, add any additional feature flags that are desired in that section of the file.  They can be place anywhere within the **feature** section of the file.\r\n\r\n> **WARNING: Be aware that turning on features (especially BETA ones) may heavily impact backend performance. DO NOT turn on features you don't need**\r\n\r\nAs we issued **instana init** from the working directory `/opt/instana`, the `settings.hcl` has been created there:\r\n```sh\r\ncd /opt/instana\r\n```\r\n\r\nBefore using vi to edit the settings.hcl file, make a backup of the file by typing:  \r\n```sh\r\ncp settings.hcl settings.hcl.bak\r\n```\r\n\r\nIn your lab enviroment, we want you to add the following feature flags.\r\n```yaml\r\nfeature \"infraCustomDashboards\" {\r\n  enabled = true\r\n}\r\nfeature \"infraEntityExplore\" {\r\n  enabled = true\r\n}\r\n```\r\n\r\nNote:  There are other feature flags that you should be aware of, <span style=\"color:red\"> but do not add these into the settings.hcl file</span>.  Here are some common feature flags available are:\r\n\r\n```yaml\r\nfeature \"vsphereEnabled\" {\r\n  enabled=true\r\n}\r\nfeature \"zhmcEnabled\" {\r\n  enabled=true\r\n}\r\nfeature \"phmcEnabled\" {\r\n  enabled=true\r\n}\r\nfeature \"beeinstana\" {\r\n  enabled=true\r\n}\r\nfeature \"smartAlertsLogsBlueprintEnabled\" {\r\n  enabled=true\r\n}\r\nfeature \"infraCustomDashboards\" {\r\n  enabled = true\r\n}\r\nfeature \"infraEntityExplore\" {\r\n  enabled = true\r\n}\r\n```\r\n\r\nNext, search for the **smtp** section in the settings.hcl file.   Modify the smtp section to look something like this.  We recommend that you edit the paramters rather than copy/paste this section.  It is easy to make a mistake with the spacing when doing a copy/paste.\r\n```sh\r\n  smtp {\r\n    from      = \"server@instana.com\"\r\n    host      = \"localhost\"\r\n    port      = 25\r\n    user      = \"jammer\"\r\n    password  = \"<jammer password provided by proctors>\"\r\n    use_ssl   = false\r\n    start_tls = false\r\n  }\r\n  ```\r\n\r\nReplace **<jammer password\\>** with the jammer password of the Instana server that was provided by the lab proctors.  If you want, you can replace the **from** parameter with any Email address that you like.  The **from** Email address is what you will see as the sender of the Email alerts from Instana.  All of the rest of the parameters should match what you see on the screen.\r\n\r\nSave the changes in the settings.hcl file.\r\n\r\n2. Run `instana update -f ./settings.hcl` to apply changes.\r\n```sh\r\ninstana update -f ./settings.hcl\r\n\r\n```\r\n\r\nIt will take a little while for the configuration changes to take effect.  Read section 1-7 while the configuration changes are being applied.\r\n\r\n***\r\n\r\n## 2-7:  Upgrading the Instana server\r\n\r\n<span style=\"color:red\">Do NOT perform these steps. But we want you to know the process for performing an upgrade.</span>\r\n  \r\n\r\nWhen upgrading an Instana server, it is important to know that you can only skip one release when upgrading.  The on-prem/self-hosted releases use odd numbers.  That means that you can upgrade from version 225 to either 227 or 229.  But, you can't upgrade from 225 to 231 because that would be skipping 2 releases and isn't supported.  It is important for customers to know this because they need to keep their Instana server patched on a fairly regular basis. Otherwise, it will mean that they will have to perform multiple steps to upgrade to the current version.\r\n\r\nBefore attempting to upgrade, you want to confirm your current version.  Issue the **instana version**\r\n```sh\r\ninstana version\r\n```\r\n\r\nNext, find out what versions are available to be installed.   Issue the the following command:\r\n```sh\r\napt-cache policy instana-console\r\n```\r\n\r\nYou will see a long list of versions that are available.  Scroll to the top of the list where you will see the most recent versions.\r\n![](images/versions.png)\r\n\r\nYou'll notice that in this example, 229-2 is the most recent version and 229-1 is the current version.  That means you can upgrade to that minor release.  There is newer major release available.\r\n\r\nFirst, install the latest instana-console.  This upgrades the **instana** command that is installed on your server:\r\n```sh\r\napt install instana-console=229-2\r\n```\r\n\r\nNext, upgrade the server by issuing the **instana update** command.  If you are in directory with the settings.hcl file, then you don't need any arguments.  Otherwise, specify the path to the settings.hcl file.\r\n```sh\r\ninstana update -f /opt/instana/settings.hcl\r\n```\r\nWhen performance the upgrade, the installer automatically pulls down the latest docker containers and gets them up and running on the Instana server.\r\n\r\n\r\n***\r\n\r\n\r\n## 2-8:  Summary\r\n\r\nIn this portion of the lab, you have learned how to install a self-hosted docker based Instana server.  For a POC, we recommend either SaaS or the single server self-hosted docker installation of the Instana server.  For production deployments, customers will want the kubernetes based deployments to gain improved scalability and resiliency.\r\n\r\nYou have also learned how to configure the SMTP settings and how to enable feature flags.\r\n\r\nFinally, you learned how to upgrade a docker based self-hosted Instana server.\r\n\r\nYou are now ready to continue with other portions of the lab.    Navigate to section 3 of the Instana lab.\r\n\r\n***\r\n\r\n\r\n\r\n\r\n\r\n\r\n","fileAbsolutePath":"C:/Users/103537778/git/waiops-tech-jam/src/pages/tutorials/instana/server/index.mdx"}}},"staticQueryHashes":["1364590287","137577622","2102389209","2456312558","2746626797","3018647132","3037994772","768070550"]}