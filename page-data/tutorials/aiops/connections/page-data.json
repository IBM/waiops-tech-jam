{"componentChunkName":"component---src-pages-tutorials-aiops-connections-index-mdx","path":"/tutorials/aiops/connections/","result":{"pageContext":{"frontmatter":{"title":"Connect an on-premise Probe","description":"Configure and connect an on-premise Netcool Probe"},"relativePagePath":"/tutorials/aiops/connections/index.mdx","titleType":"page","MdxNode":{"id":"24b8ab26-0113-58e2-9e01-6c74358f1ccf","children":[],"parent":"a955608e-7b84-5600-b3a1-a109b6b75d11","internal":{"content":"---\ntitle: Connect an on-premise Probe\ndescription: Configure and connect an on-premise Netcool Probe\n---\n\n<AnchorLinks>\n  <AnchorLink>3-1: Overview</AnchorLink>\n  <AnchorLink>3-2: Enable Nodeports</AnchorLink>\n  <AnchorLink>3-3: Gather the cluster connection information</AnchorLink>\n  <AnchorLink>3-4: Configure probe to connect to the cluster</AnchorLink>\n</AnchorLinks>\n\n\n\n## 3-1: Overview\n\nThis module focuses on configuring and connecting an on-premise Netcool/Probe to the Event Manager.  In most demonstration or POC scenarios, there will be an existing on-premise Netcool deployment present, and there will be a need to connect that environment to the system running on OpenShift. Typically this will involve connecting Probes or uni-directional ObjectServer Gateways into the Event Manager, to provide a source of events.\n\n**NOTE:** This module assumes you have an existing on-premise Netcool/OMNIbus deployment that you want to connect into your Event Manager system. If this is not the case, and you are using only webhook-based event feeds (configured via the GUI), you can skip this module and move on to module 3.\n\nThis deployment scenario will assume you are deploying onto IBM Cloud however the steps would generally apply to an OpenShift cluster deployed on another cloud provider or on-premise.\n\nBy the end of this module, you will have enabled the ObjectServer nodeports on your cluster, configured your on-premise Netcool/OMNIbus system to connect to the ObjectServer embedded within Event Manager, and connected a Probe.\n\n\n## 3-2: Enable Nodeports\n\nBehind the scenes, the event stores in Watson for AIOps Event Manager are Netcool/OMNIbus ObjectServers. These are running in containers and are not accessible outside the cluster by default. This first step involves modifying your Event Manager deployment to activate the nodeports.\n\nLog in to your OpenShift UI and navigate to: **Operators → Installed Operators → IBM Cloud Pak for Watson AIOps Event Manager → NOI**.\n\nNext, click on your deployment - for example: **evtmanager** - and then click on the **YAML** tab.\n\nAdd a new sub-section to the **spec**: section in your configuration with the following text:\n\n```sh\n  helmValuesNOI:\n    global.service.nodePort.enable: true\n```\n\n**NOTE**: the spacing and indentation is important here.\n\nAfter you have added this sub-section and clicked Save, the resulting configuration should look something like the following:\n\n![](images/0_yaml.png)\n\n**NOTE:** In this screenshot, other properties have also been added. The key added lines are on lines **196** and **198**.\n\nAfter you have saved the configuration, OpenShift will detect the change, and redeploy the relevant services.\n\nNext, log in to the OpenShift cluster via the command line, as you did in the previous module. To check that the nodeports have been successfully deployed, you can query the Proxy Service, and check its output for the nodeport values:\n\n```sh\n$ oc get service -o yaml evtmanager-proxy -n noi\n```\nOutput looks like :\n\n![](images/1_proxy.png)\n\nFrom the output above, you can see that the nodeports have been deployed on ports **32767** for the primary ObjectServer and **31280** for the backup. These are the port numbers that are externally accessible to the cluster and are what your Netcool Probe (or in-bound Netcool Gateway) will use to connect.\n\n**NOTE:** Make a note of these port numbers as you'll need them in subsequent steps.\n\nFor more information on this step, see the following documentation link: https://www.ibm.com/docs/en/noi/1.6.5?topic=service-identifying-proxy-listening-port\n\n## 3-3: Gather the cluster connection information\n\nThis step involves compiling information about the cluster's certificate common name (CN) and acquiring the cluster certificate for import into the Probe server.\n\nIn the previous module, you identified the Ingress subdomain from the IBM Cloud UI, from the information relating to your cluster.\n\nPing the Ingress subdomain to identify the IP address to use to communicate with the cluster:\n\n```sh\n\n$ ping swat01-4693fb98e216XXXXXXXXXXX-0000.us-east.containers.appdomain.cloud\n\nPING swat01-4693fb98e21XXXXXXXXXXXXx-0000.us-east.containers.appdomain.cloud (5X.XXX.XX.XXX) 56(84) bytes of data.\n64 bytes from evtmanager-proxy.noi.svc (5X.XXX.XX.XXX): icmp_seq=1 ttl=46 time=89.2 ms\n^C\n--- swat01-4693fb98e216d6XXXXXXXXXXXXXX-0000.us-east.containers.appdomain.cloud ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 89.216/93.100/96.985/3.896 ms\n$\n``\nTwo things to note from the example output above are the proxy service name: evtmanager-proxy.noi.svc - and the IP address: 5X.XXX.XX.XXX. These represent the hostname and IP address we will be using to communicate with the cluster.\n\n**NOTE:** Make a note of the proxy service name and IP address as you need them shortly.\n\nNext, log into your server where the Netcool/Probe is installed. Use the OpenSSL command to retrieve the x.509 certificate that is returned by the proxy and verify the certificate common name (CN). You need to again use the Ingress subdomain value in conjunction with the nodeport value you discovered in Step 1:\n\n```sh\n$ openssl s_client -showcerts -connect swat01-469XXXXXXXXXXXXXXXXXXXXXXXXXc049-0000.us-east.containers.appdomain.cloud:32767\n\nCONNECTED(00000003)\ndepth=1 CN = openshift-service-serving-signer@1645115959\nverify return:1\ndepth=1 CN = openshift-service-serving-signer@1645115959\nverify return:1\ndepth=0 CN = evtmanager-proxy.noi.svc\nverify return:1\n---\nCertificate chain\n0 s:CN = evtmanager-proxy.noi.svc\n...\n```\n\nHere you can see the proxy service name being used by the server, that is associated with the certificate, and that it matches the hostname returned by the ping command earlier. This is important because the hostname we use to connect to the cluster must match that referred to in the certificate in order for the SSL connection to work correctly.\n\nFinally, download the certificate from the cluster using the oc utility:\n\n```sh\noc get secrets/signing-key -n openshift-service-ca -o template='{{index .data \"tls.crt\"}}' | base64 --decode > cluster-ca-cert.pem \n```\n\nCopy this file (cluster-ca-cert.pem) to the Probe server in preparation for the next step.\n\nFor more information on this step, see the following documentation link: https://www.ibm.com/docs/en/noi/1.6.5?topic=service-configuring-tls-encryption-red-hat-openshift\n\n## 3-4: Configure probe to connect to the cluster\n\nNow that we have the proxy service hostname, the nodeport of the primary ObjectServer, and the cluster's certificate, we are ready to configure the Probe to connect to the Event Manager.\n\nLog in to the Probe server and add an entry to the /etc/hosts file with the cluster IP address and the proxy service hostname obtained previously:\n\n5X.XXX.XX.XXX evtmanager-proxy.noi.svc\n\nThis is the hostname that will be used in the Netcool interfaces file.\n\nIf you haven't already created one previously, create a keystore on your Probe server to import the certificate into:\n\n```sh\nexport NCHOME=/home/scadmin/IBM/tivoli/netcool\n$NCHOME/bin/nc_gskcmd -keydb -create -db \"$NCHOME/etc/security/keys/omni.kdb\" -pw password -stash -expire 1000\n```\n\nCopy the certificate you downloaded in Step 2 to the Probe server, and import it into your newly created keystore:\n\n```sh\n$NCHOME/bin/nc_gskcmd -cert -add -file cluster-ca-cert.pem -db $NCHOME/etc/security/keys/omni.kdb -stashed\n```\n\nCreate an interfaces file entry in $NCHOME/etc/omni.dat, representing the primary ObjectServer running in OpenShift:\n\n```sh\n[ROKS_AGG_P]\n{\n Primary: noi-proxy.noi.svc ssl 32767\n}\n```\n\n**NOTE:** The entry contains the string ssl which indicates that an encrypted connection should be used.\n\nRun nco_igen to update the interfaces file information.\n\n```sh\n$NCHOME/bin/nco_igen\n```\n\nUse the nco_ping utility to test the connection the ObjectServer:\n\n$ $OMNIHOME/bin/nco_ping ROKS_AGG_P\nNCO_PING: Server available.\n$ \n\nYou are now ready to connect your Probe.\n\nFor more information on this step, see the following documentation link: https://www.ibm.com/docs/en/noi/1.6.5?topic=service-configuring-tls-encryption-red-hat-openshift\n\n## 3.4: Configure and connect a Netcool/Probe\n\nThe fourth and final step is to configure the Probe to connect to the primary ObjectServer running in OpenShift. \n\nUsing the Simnet Probe as an example, run the Probe in debug mode to ensure that the Probe can connect to the ObjectServer:\n\n```sh\nexport OMNIHOME=/home/scadmin/IBM/tivoli/netcool/omnibus\n$OMNIHOME/probes/nco_p_simnet -server ROKS_AGG_P -messagelevel debug -messagelog stdout\n```\n\nAfter verifying successful connect to the ObjectServer, you can run the Probe outside of debug mode, normally under Process Agent control.\n\n\n[Reference Blog](https://community.ibm.com/community/user/aiops/blogs/zane-bray1/2022/04/13/getting-started-with-watson-aiops-event-manager-27)","type":"Mdx","contentDigest":"6e7cc9a42b05467f0de34d1f27712064","owner":"gatsby-plugin-mdx","counter":925},"frontmatter":{"title":"Connect an on-premise Probe","description":"Configure and connect an on-premise Netcool Probe"},"exports":{},"rawBody":"---\ntitle: Connect an on-premise Probe\ndescription: Configure and connect an on-premise Netcool Probe\n---\n\n<AnchorLinks>\n  <AnchorLink>3-1: Overview</AnchorLink>\n  <AnchorLink>3-2: Enable Nodeports</AnchorLink>\n  <AnchorLink>3-3: Gather the cluster connection information</AnchorLink>\n  <AnchorLink>3-4: Configure probe to connect to the cluster</AnchorLink>\n</AnchorLinks>\n\n\n\n## 3-1: Overview\n\nThis module focuses on configuring and connecting an on-premise Netcool/Probe to the Event Manager.  In most demonstration or POC scenarios, there will be an existing on-premise Netcool deployment present, and there will be a need to connect that environment to the system running on OpenShift. Typically this will involve connecting Probes or uni-directional ObjectServer Gateways into the Event Manager, to provide a source of events.\n\n**NOTE:** This module assumes you have an existing on-premise Netcool/OMNIbus deployment that you want to connect into your Event Manager system. If this is not the case, and you are using only webhook-based event feeds (configured via the GUI), you can skip this module and move on to module 3.\n\nThis deployment scenario will assume you are deploying onto IBM Cloud however the steps would generally apply to an OpenShift cluster deployed on another cloud provider or on-premise.\n\nBy the end of this module, you will have enabled the ObjectServer nodeports on your cluster, configured your on-premise Netcool/OMNIbus system to connect to the ObjectServer embedded within Event Manager, and connected a Probe.\n\n\n## 3-2: Enable Nodeports\n\nBehind the scenes, the event stores in Watson for AIOps Event Manager are Netcool/OMNIbus ObjectServers. These are running in containers and are not accessible outside the cluster by default. This first step involves modifying your Event Manager deployment to activate the nodeports.\n\nLog in to your OpenShift UI and navigate to: **Operators → Installed Operators → IBM Cloud Pak for Watson AIOps Event Manager → NOI**.\n\nNext, click on your deployment - for example: **evtmanager** - and then click on the **YAML** tab.\n\nAdd a new sub-section to the **spec**: section in your configuration with the following text:\n\n```sh\n  helmValuesNOI:\n    global.service.nodePort.enable: true\n```\n\n**NOTE**: the spacing and indentation is important here.\n\nAfter you have added this sub-section and clicked Save, the resulting configuration should look something like the following:\n\n![](images/0_yaml.png)\n\n**NOTE:** In this screenshot, other properties have also been added. The key added lines are on lines **196** and **198**.\n\nAfter you have saved the configuration, OpenShift will detect the change, and redeploy the relevant services.\n\nNext, log in to the OpenShift cluster via the command line, as you did in the previous module. To check that the nodeports have been successfully deployed, you can query the Proxy Service, and check its output for the nodeport values:\n\n```sh\n$ oc get service -o yaml evtmanager-proxy -n noi\n```\nOutput looks like :\n\n![](images/1_proxy.png)\n\nFrom the output above, you can see that the nodeports have been deployed on ports **32767** for the primary ObjectServer and **31280** for the backup. These are the port numbers that are externally accessible to the cluster and are what your Netcool Probe (or in-bound Netcool Gateway) will use to connect.\n\n**NOTE:** Make a note of these port numbers as you'll need them in subsequent steps.\n\nFor more information on this step, see the following documentation link: https://www.ibm.com/docs/en/noi/1.6.5?topic=service-identifying-proxy-listening-port\n\n## 3-3: Gather the cluster connection information\n\nThis step involves compiling information about the cluster's certificate common name (CN) and acquiring the cluster certificate for import into the Probe server.\n\nIn the previous module, you identified the Ingress subdomain from the IBM Cloud UI, from the information relating to your cluster.\n\nPing the Ingress subdomain to identify the IP address to use to communicate with the cluster:\n\n```sh\n\n$ ping swat01-4693fb98e216XXXXXXXXXXX-0000.us-east.containers.appdomain.cloud\n\nPING swat01-4693fb98e21XXXXXXXXXXXXx-0000.us-east.containers.appdomain.cloud (5X.XXX.XX.XXX) 56(84) bytes of data.\n64 bytes from evtmanager-proxy.noi.svc (5X.XXX.XX.XXX): icmp_seq=1 ttl=46 time=89.2 ms\n^C\n--- swat01-4693fb98e216d6XXXXXXXXXXXXXX-0000.us-east.containers.appdomain.cloud ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 89.216/93.100/96.985/3.896 ms\n$\n``\nTwo things to note from the example output above are the proxy service name: evtmanager-proxy.noi.svc - and the IP address: 5X.XXX.XX.XXX. These represent the hostname and IP address we will be using to communicate with the cluster.\n\n**NOTE:** Make a note of the proxy service name and IP address as you need them shortly.\n\nNext, log into your server where the Netcool/Probe is installed. Use the OpenSSL command to retrieve the x.509 certificate that is returned by the proxy and verify the certificate common name (CN). You need to again use the Ingress subdomain value in conjunction with the nodeport value you discovered in Step 1:\n\n```sh\n$ openssl s_client -showcerts -connect swat01-469XXXXXXXXXXXXXXXXXXXXXXXXXc049-0000.us-east.containers.appdomain.cloud:32767\n\nCONNECTED(00000003)\ndepth=1 CN = openshift-service-serving-signer@1645115959\nverify return:1\ndepth=1 CN = openshift-service-serving-signer@1645115959\nverify return:1\ndepth=0 CN = evtmanager-proxy.noi.svc\nverify return:1\n---\nCertificate chain\n0 s:CN = evtmanager-proxy.noi.svc\n...\n```\n\nHere you can see the proxy service name being used by the server, that is associated with the certificate, and that it matches the hostname returned by the ping command earlier. This is important because the hostname we use to connect to the cluster must match that referred to in the certificate in order for the SSL connection to work correctly.\n\nFinally, download the certificate from the cluster using the oc utility:\n\n```sh\noc get secrets/signing-key -n openshift-service-ca -o template='{{index .data \"tls.crt\"}}' | base64 --decode > cluster-ca-cert.pem \n```\n\nCopy this file (cluster-ca-cert.pem) to the Probe server in preparation for the next step.\n\nFor more information on this step, see the following documentation link: https://www.ibm.com/docs/en/noi/1.6.5?topic=service-configuring-tls-encryption-red-hat-openshift\n\n## 3-4: Configure probe to connect to the cluster\n\nNow that we have the proxy service hostname, the nodeport of the primary ObjectServer, and the cluster's certificate, we are ready to configure the Probe to connect to the Event Manager.\n\nLog in to the Probe server and add an entry to the /etc/hosts file with the cluster IP address and the proxy service hostname obtained previously:\n\n5X.XXX.XX.XXX evtmanager-proxy.noi.svc\n\nThis is the hostname that will be used in the Netcool interfaces file.\n\nIf you haven't already created one previously, create a keystore on your Probe server to import the certificate into:\n\n```sh\nexport NCHOME=/home/scadmin/IBM/tivoli/netcool\n$NCHOME/bin/nc_gskcmd -keydb -create -db \"$NCHOME/etc/security/keys/omni.kdb\" -pw password -stash -expire 1000\n```\n\nCopy the certificate you downloaded in Step 2 to the Probe server, and import it into your newly created keystore:\n\n```sh\n$NCHOME/bin/nc_gskcmd -cert -add -file cluster-ca-cert.pem -db $NCHOME/etc/security/keys/omni.kdb -stashed\n```\n\nCreate an interfaces file entry in $NCHOME/etc/omni.dat, representing the primary ObjectServer running in OpenShift:\n\n```sh\n[ROKS_AGG_P]\n{\n Primary: noi-proxy.noi.svc ssl 32767\n}\n```\n\n**NOTE:** The entry contains the string ssl which indicates that an encrypted connection should be used.\n\nRun nco_igen to update the interfaces file information.\n\n```sh\n$NCHOME/bin/nco_igen\n```\n\nUse the nco_ping utility to test the connection the ObjectServer:\n\n$ $OMNIHOME/bin/nco_ping ROKS_AGG_P\nNCO_PING: Server available.\n$ \n\nYou are now ready to connect your Probe.\n\nFor more information on this step, see the following documentation link: https://www.ibm.com/docs/en/noi/1.6.5?topic=service-configuring-tls-encryption-red-hat-openshift\n\n## 3.4: Configure and connect a Netcool/Probe\n\nThe fourth and final step is to configure the Probe to connect to the primary ObjectServer running in OpenShift. \n\nUsing the Simnet Probe as an example, run the Probe in debug mode to ensure that the Probe can connect to the ObjectServer:\n\n```sh\nexport OMNIHOME=/home/scadmin/IBM/tivoli/netcool/omnibus\n$OMNIHOME/probes/nco_p_simnet -server ROKS_AGG_P -messagelevel debug -messagelog stdout\n```\n\nAfter verifying successful connect to the ObjectServer, you can run the Probe outside of debug mode, normally under Process Agent control.\n\n\n[Reference Blog](https://community.ibm.com/community/user/aiops/blogs/zane-bray1/2022/04/13/getting-started-with-watson-aiops-event-manager-27)","fileAbsolutePath":"/Volumes/SSD Storage/IBM-DEVELOPMENT/TECHJAM2022/IBM/waiops-tech-jam/src/pages/tutorials/aiops/connections/index.mdx"}}},"staticQueryHashes":["1364590287","137577622","2102389209","2456312558","2746626797","3018647132","3037994772","768070550"]}