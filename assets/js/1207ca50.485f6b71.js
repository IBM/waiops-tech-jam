"use strict";(self.webpackChunkswat_hub=self.webpackChunkswat_hub||[]).push([[1978],{15680:(e,t,n)=>{n.d(t,{xA:()=>m,yg:()=>u});var a=n(96540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},y=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),c=p(n),y=r,u=c["".concat(s,".").concat(y)]||c[y]||d[y]||o;return n?a.createElement(u,l(l({ref:t},m),{},{components:n})):a.createElement(u,l({ref:t},m))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=y;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[c]="string"==typeof e?e:r,l[1]=i;for(var p=2;p<o;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}y.displayName="MDXCreateElement"},91348:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var a=n(58168),r=(n(96540),n(15680));const o={title:"4. OpenTelemetry instrumentation",description:"Instrument demo application with OpenTelemetry",sidebar_position:5},l=void 0,i={unversionedId:"instana/opentelemetry/opentelemetry-instrumentation/index",id:"instana/opentelemetry/opentelemetry-instrumentation/index",title:"4. OpenTelemetry instrumentation",description:"Instrument demo application with OpenTelemetry",source:"@site/labs/instana/opentelemetry/4-opentelemetry-instrumentation/index.mdx",sourceDirName:"instana/opentelemetry/4-opentelemetry-instrumentation",slug:"/instana/opentelemetry/opentelemetry-instrumentation/",permalink:"/waiops-tech-jam/labs/instana/opentelemetry/opentelemetry-instrumentation/",draft:!1,editUrl:"https://github.com/IBM/waiops-tech-jam/tree/main/labs/instana/opentelemetry/4-opentelemetry-instrumentation/index.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"4. OpenTelemetry instrumentation",description:"Instrument demo application with OpenTelemetry",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"3. Instana agent installation",permalink:"/waiops-tech-jam/labs/instana/opentelemetry/agent-installation/"},next:{title:"5. Web-application monitoring",permalink:"/waiops-tech-jam/labs/instana/opentelemetry/webapplication-monitoring/"}},s={},p=[{value:"Enable OpenTelemetry in Instana",id:"enable-opentelemetry-in-instana",level:2},{value:"Restart cluster workload",id:"restart-cluster-workload",level:2},{value:"Verify OpenTelemetry Demo Application",id:"verify-opentelemetry-demo-application",level:2},{value:"Create an Application in Instana",id:"create-an-application-in-instana",level:2},{value:"Generate OpenTelemetry Demo Application traffic",id:"generate-opentelemetry-demo-application-traffic",level:2}],m={toc:p},c="wrapper";function d(e){let{components:t,...o}=e;return(0,r.yg)(c,(0,a.A)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("admonition",{title:"Work In Progress",type:"warning"},(0,r.yg)("p",{parentName:"admonition"},"This lab is currently under development.")),(0,r.yg)("h1",{id:"opentelemetry-instrumentation"},"OpenTelemetry instrumentation"),(0,r.yg)("p",null,"For the purpose of this lab, we will use Instana OpenTelemetry Demo Application\n",(0,r.yg)("a",{parentName:"p",href:"https://github.com/instana/opentelemetry-demo/tree/main"},"https://github.com/instana/opentelemetry-demo/tree/main")," which is the fork of\ngeneric OpenTelemetry Demo Application available here\n",(0,r.yg)("a",{parentName:"p",href:"https://github.com/open-telemetry/opentelemetry-demo"},"https://github.com/open-telemetry/opentelemetry-demo"),"."),(0,r.yg)("p",null,"Instana's custom fork of the OpenTelemetry Demo Application is a\nmicroservice-based application, integrated with an Instana backend. The demo\nshows the native Instana OpenTelemetry data collection, correlation of\nOpenTelemetry tracing and the underlying monitored infrastructure, and an\nexample of trace continuity between Instana tracing and OpenTelemetry."),(0,r.yg)("p",null,"OpenTelemetry Demo Application was already installed for you in the lab\nenvironment. The following steps are required to enable OpenTelemetry in the\nInstana agent."),(0,r.yg)("p",null,"OpenTelemetry is an open-source observability framework with a collection of\nsoftware development kits (SDKs), vendor-neutral or vendor-agnostic APIs, and\ntools for instrumentation. This technology can generate, collect, export, and\ninstrument telemetry data to analyze your platform's behavior and performance.\nOpentelemetry is also known as OTel. OpenTelemetry is included into Instana\nlicense, there's no additional payment required."),(0,r.yg)("h2",{id:"enable-opentelemetry-in-instana"},"Enable OpenTelemetry in Instana"),(0,r.yg)("p",null,"First, let's make sure you are using the correct project in your OCP cluster"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"oc project instana-agent\n")),(0,r.yg)("p",null,"Now, let's edit the configmap of instana-agent. We need to let instana-agent\nknow which OpenTelemetry settings are required"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"oc edit configmap --namespace instana-agent\n")),(0,r.yg)("p",null,"Remove all commented lines from the configuration section as described below."),(0,r.yg)("p",null,'You can use "dd" in the text editor to remove a single line from the file.'),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"configmap",src:n(98697).A,width:"795",height:"1028"})),(0,r.yg)("p",null,"Once the remove is done, copy and paste the below configuration content."),(0,r.yg)("p",null,"Please note that there are exact number of spaces required."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yaml"},'com.instana.plugin.opentelemetry:\n  # enabled: false       # legacy setting, will only enable grpc, defaults to false\n  grpc:\n    enabled: true # takes precedence over legacy settings above, defaults to true iff "grpc:" is present\n  http:\n    enabled: true # allows to enable http endpoints, defaults to true iff "http:" is present\n\ncom.instana.ignore:\n  arguments:\n    # - \'-javaagent:/opt/otel/opentelemetry-javaagent-all.jar\'\n    # - \'-javaagent:/app/opentelemetry-javaagent.jar\'\n    # - \'-javaagent:/tmp/opentelemetry-javaagent.jar\'\n\ncom.instana.tracing:\n  extra-http-headers:\n    - traceparent\n    - tracestate\n\ncom.instana.plugin.generic.hardware:\n  enabled: true\n\n# otel-demo configurations\ncom.instana.plugin.postgresql:\n  user: "ffs"\n  password: "ffs"\n  database: "postgres"\n\ncom.instana.plugin.javatrace:\n  instrumentation:\n    enabled: false\n  trace-jvms-with-problematic-agents: true\n\ncom.instana.plugin.python:\n  autotrace:\n    enabled: false\n\ncom.instana.plugin.php:\n  tracing:\n    enabled: false\n')),(0,r.yg)("p",null,"The final structure of the configmap should look like the below example"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"configmap",src:n(2182).A,width:"1135",height:"887"})),(0,r.yg)("p",null,'Save the file by typing ":wq"'),(0,r.yg)("h2",{id:"restart-cluster-workload"},"Restart cluster workload"),(0,r.yg)("p",null,"Restart all of the instana agents pods to ensure that configmap change was\nimplemented."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"oc rollout restart daemonset instana-agent --namespace instana-agent\n")),(0,r.yg)("p",null,"Restart will prompt with a message"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"daemonset.apps/instana-agent restarted\n")),(0,r.yg)("p",null,"Restart all of the Otel Demo app pods to ensure the Instana injection was done."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"kubectl -n otel-demo rollout restart deploy\n")),(0,r.yg)("p",null,"Restart will prompt with a message"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"deployment.apps/my-otel-demo-accountingservice restarted\ndeployment.apps/my-otel-demo-adservice restarted\ndeployment.apps/my-otel-demo-cartservice restarted\ndeployment.apps/my-otel-demo-checkoutservice restarted\ndeployment.apps/my-otel-demo-currencyservice restarted\ndeployment.apps/my-otel-demo-emailservice restarted\ndeployment.apps/my-otel-demo-featureflagservice restarted\ndeployment.apps/my-otel-demo-ffspostgres restarted\ndeployment.apps/my-otel-demo-frauddetectionservice restarted\ndeployment.apps/my-otel-demo-frontend restarted\ndeployment.apps/my-otel-demo-frontendproxy restarted\ndeployment.apps/my-otel-demo-kafka restarted\ndeployment.apps/my-otel-demo-loadgenerator restarted\ndeployment.apps/my-otel-demo-paymentservice restarted\ndeployment.apps/my-otel-demo-productcatalogservice restarted\ndeployment.apps/my-otel-demo-quoteservice restarted\ndeployment.apps/my-otel-demo-recommendationservice restarted\ndeployment.apps/my-otel-demo-redis restarted\ndeployment.apps/my-otel-demo-shippingservice restarted\n")),(0,r.yg)("h2",{id:"verify-opentelemetry-demo-application"},"Verify OpenTelemetry Demo Application"),(0,r.yg)("p",null,"Once the instana-agent and OpenTelemetry Demo Application were restarted, it is\nnow time to Verify if the applications works and delivers metrics as expected."),(0,r.yg)("p",null,"Let's find out what is the OpenTelemetry Demo Application route by using below\ncommand"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"oc project otel-demo\noc get routes\n")),(0,r.yg)("p",null,"The results will be similar to the below output"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sh"},"NAME           HOST/PORT                                            PATH   SERVICES                     PORT          TERMINATION   WILDCARD\nmy-otel-demo   my-otel-demo-otel-demo.xxxxxxx.ibm.com          my-otel-demo-frontendproxy   tcp-service   edge          None\n\n")),(0,r.yg)("p",null,"Your instance of OpenTelemetry Demo Application is available under the\n",(0,r.yg)("a",{parentName:"p",href:"https://my-otel-demo-otel-demo.xxxxxxx.ibm.com."},"https://my-otel-demo-otel-demo.xxxxxxx.ibm.com.")," Let's use a browser to open that\npage. Please note the https in the address bar. Also, do not worry about the\nsecurity message - accept the self-signed certificate."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"otelapp",src:n(58337).A,width:"1907",height:"936"})),(0,r.yg)("h2",{id:"create-an-application-in-instana"},"Create an Application in Instana"),(0,r.yg)("p",null,"Now, let's create an application perspective in Instana. Log in to your Instana\ninstance and create new application perspective."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"appperspective",src:n(9410).A,width:"1189",height:"728"})),(0,r.yg)("p",null,'Switch to "Advanced mode"'),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"appperspective2",src:n(23071).A,width:"1043",height:"632"})),(0,r.yg)("p",null,'Provide application name of your choice, your cluster name, select "All\ndownstream services" and "All calls", click "Create"'),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"appperspective2",src:n(57341).A,width:"1049",height:"967"})),(0,r.yg)("h2",{id:"generate-opentelemetry-demo-application-traffic"},"Generate OpenTelemetry Demo Application traffic"),(0,r.yg)("p",null,"Once the demo application is up and running, let's generate some traffic. Go\nback to the OpenTelemetry Demo Application in the browser, click through the\nsite and explore the page, add products to the cart, make some orders."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"appperspective2",src:n(85624).A,width:"1902",height:"922"})),(0,r.yg)("p",null,"Once you have purchased some of the products, let's go back to the Instana UI,\nopen your Application Perspective to see the captured traffic."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"appperspective3",src:n(9494).A,width:"2455",height:"1126"})),(0,r.yg)("p",null,"This view concludes chapter 4. You are now able to see the traffic from your\ninstance of the OpenTelemetry Demo Application captured by Instana. Let's move\nto the next sections."))}d.isMDXComponent=!0},98697:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/otel-instrumentation-001-fixed-1ced9c1b830af9cf59ed8589e65cfd21.png"},9410:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/otel-instrumentation-002-fixed-95b93c68eab9d1cca862727639ad5f96.png"},23071:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/otel-instrumentation-003-fixed-fbffaddaa4aa24f80a1c05c348014e54.png"},57341:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/otel-instrumentation-005-fixed-ca59239dd31f393595e4fde919c10067.png"},9494:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/otel-instrumentation-006-fixed-19c28cc62195abc99479e6fb25d20ab8.png"},2182:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/otel-instrumentation-007-dd2661dfa890f340cef9441caf7de229.png"},58337:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/otel-instrumentation-008-b7848518eb846b1eb4d3959ac0f2015b.png"},85624:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/otel-instrumentation-009-2e7bad3cb5b23ba5a112cdf58d45e1dc.png"}}]);