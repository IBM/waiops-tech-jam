"use strict";(self.webpackChunkswat_hub=self.webpackChunkswat_hub||[]).push([[4094],{15680:(e,t,n)=>{n.d(t,{xA:()=>c,yg:()=>u});var a=n(96540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},g="mdxType",y={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),g=s(n),m=o,u=g["".concat(p,".").concat(m)]||g[m]||y[m]||i;return n?a.createElement(u,r(r({ref:t},c),{},{components:n})):a.createElement(u,r({ref:t},c))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[g]="string"==typeof e?e:o,r[1]=l;for(var s=2;s<i;s++)r[s]=n[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},81368:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>y,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var a=n(58168),o=(n(96540),n(15680));const i={title:"5. Create an event housekeeping automation",description:"Set up an event housekeeping automation",sidebar_position:5},r=void 0,l={unversionedId:"cloud-pak-aiops/migration-from-netcool/housekeeping/index",id:"cloud-pak-aiops/migration-from-netcool/housekeeping/index",title:"5. Create an event housekeeping automation",description:"Set up an event housekeeping automation",source:"@site/labs/cloud-pak-aiops/migration-from-netcool/5-housekeeping/index.mdx",sourceDirName:"cloud-pak-aiops/migration-from-netcool/5-housekeeping",slug:"/cloud-pak-aiops/migration-from-netcool/housekeeping/",permalink:"/waiops-tech-jam/labs/cloud-pak-aiops/migration-from-netcool/housekeeping/",draft:!1,editUrl:"https://github.com/IBM/waiops-tech-jam/tree/main/labs/cloud-pak-aiops/migration-from-netcool/5-housekeeping/index.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"5. Create an event housekeeping automation",description:"Set up an event housekeeping automation",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"4. Set up the Netcool/Impact Connector",permalink:"/waiops-tech-jam/labs/cloud-pak-aiops/migration-from-netcool/impact-connector/"},next:{title:"6. Create a right-click tool",permalink:"/waiops-tech-jam/labs/cloud-pak-aiops/migration-from-netcool/right-click-tool/"}},p={},s=[{value:"5.1: Overview",id:"51-overview",level:2},{value:"5.2 Create a Netcool/Impact policy",id:"52-create-a-netcoolimpact-policy",level:2},{value:"5.3 Create a new AIOps policy",id:"53-create-a-new-aiops-policy",level:2},{value:"5.4: Clear the events in Netcool/OMNIbus",id:"54-clear-the-events-in-netcoolomnibus",level:2},{value:"5.5: View the Alerts viewer",id:"55-view-the-alerts-viewer",level:2}],c={toc:s},g="wrapper";function y(e){let{components:t,...i}=e;return(0,o.yg)(g,(0,a.A)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("h2",{id:"51-overview"},"5.1: Overview"),(0,o.yg)("p",null,"In this Lab, you will create an event housekeeping automation that will set the ",(0,o.yg)("inlineCode",{parentName:"p"},"expirySeconds")," attribute for every event. When this attribute is set, an internal AIOps automation will automatically clear any events whose last occurrence is more than ",(0,o.yg)("inlineCode",{parentName:"p"},"expirySeconds")," ago. Note that this is equivalent to setting the ",(0,o.yg)("inlineCode",{parentName:"p"},"@ExpireTime")," field in Netcool/OMNIbus, which is then acted on by the ",(0,o.yg)("inlineCode",{parentName:"p"},"expire")," trigger. Indeed, if you map the ",(0,o.yg)("inlineCode",{parentName:"p"},"@ExpireTime")," field to the ",(0,o.yg)("inlineCode",{parentName:"p"},"expirySeconds")," attribute in AIOps, it will achieve the same result. It is important to have a default event expiry automation in-place in AIOps in any case however, since not all events in AIOps originate in Netcool, and hence there needs to be some sort of r\xe9gime in-place to cater to these events too."),(0,o.yg)("h2",{id:"52-create-a-netcoolimpact-policy"},"5.2 Create a Netcool/Impact policy"),(0,o.yg)("p",null,"In this section, you will create a JavaScript policy in Netcool/Impact that will be used to set the ",(0,o.yg)("inlineCode",{parentName:"p"},"expirySeconds")," attribute in events, depending on the criteria that are define. In our case, we will create a policy that sets ",(0,o.yg)("inlineCode",{parentName:"p"},"expirySeconds")," based on the severity of the event. Use the following steps to create the new housekeeping policy in Netcool/Impact:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Navigate to the Netcool/Impact GUI: ",(0,o.yg)("inlineCode",{parentName:"li"},"https://netcoolvm:16311/ibm/console")),(0,o.yg)("li",{parentName:"ul"},"Log in to Netcool/Impact as the user ",(0,o.yg)("inlineCode",{parentName:"li"},"impactadmin")," and password ",(0,o.yg)("inlineCode",{parentName:"li"},"netcool")),(0,o.yg)("li",{parentName:"ul"},"Click on ",(0,o.yg)("strong",{parentName:"li"},"Policies")),(0,o.yg)("li",{parentName:"ul"},"Click on the pull-down menu button on the new policy button and select ",(0,o.yg)("strong",{parentName:"li"},"JavaScript Policy")),(0,o.yg)("li",{parentName:"ul"},"Copy and paste the following sample policy into the policy editor:")),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},'Load(\'AIOPS_Utils\');\n// ONLY SET expirySeconds FOR EVENTS WHERE IT IS NOT SET\nif (String(EventContainer.alert.expirySeconds) == "undefined" || String(EventContainer.alert.expirySeconds) == "0") {\n  // KEEP CRITICAL ALERTS FOR SEVEN DAYS\n  if (Int(EventContainer.alert.severity) == 6) {\n    aiopsUtils.patchAlertNoWait(EventContainer.alert.id,{expirySeconds:604800});}\n  // KEEP MAJOR ALERTS FOR FIVE DAYS\n  else if (Int(EventContainer.alert.severity) == 5) {\n    aiopsUtils.patchAlertNoWait(EventContainer.alert.id,{expirySeconds:432000}); }\n  // KEEP MINOR ALERTS FOR THREE DAYS\n  else if (Int(EventContainer.alert.severity) == 4) {\n    aiopsUtils.patchAlertNoWait(EventContainer.alert.id,{expirySeconds:259200}); }\n  // KEEP WARNING ALERTS FOR ONE DAY\n  else if (Int(EventContainer.alert.severity) == 3) {\n    aiopsUtils.patchAlertNoWait(EventContainer.alert.id,{expirySeconds:86400}); }\n  // KEEP INFORMATIONAL EVENTS FOR TWELVE HOURS\n  else if (Int(EventContainer.alert.severity) == 2) {\n    aiopsUtils.patchAlertNoWait(EventContainer.alert.id,{expirySeconds:43200}); }\n  // KEEP INDETERMINATE EVENTS FOR SIX HOURS\n  else if (Int(EventContainer.alert.severity) == 1) {\n    aiopsUtils.patchAlertNoWait(EventContainer.alert.id,{expirySeconds:21600}); }\n} \n')),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Click on the ",(0,o.yg)("strong",{parentName:"li"},"Save")," button and save the policy as: ",(0,o.yg)("inlineCode",{parentName:"li"},"AIOPS_Housekeeping"))),(0,o.yg)("h2",{id:"53-create-a-new-aiops-policy"},"5.3 Create a new AIOps policy"),(0,o.yg)("p",null,"In this section, you will create an AIOps automation policy that will send events to the newly created Netcool/Impact policy."),(0,o.yg)("p",null,"Use the following steps to create the new AIOps automation policy:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Log in to the AIOps console and select ",(0,o.yg)("strong",{parentName:"li"},"Automations")," from the main menu"),(0,o.yg)("li",{parentName:"ul"},"Click the ",(0,o.yg)("strong",{parentName:"li"},"Create policy")," button and choose ",(0,o.yg)("strong",{parentName:"li"},"Invoke IBM Tivoli Netcool/Impact")," to create a new policy"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Policy name"),": give your policy the name: ",(0,o.yg)("inlineCode",{parentName:"li"},"Housekeeping")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Trigger entity"),": leave it set to ",(0,o.yg)("inlineCode",{parentName:"li"},"Alert")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Trigger entity type"),": ensure ",(0,o.yg)("strong",{parentName:"li"},"After an alert is created")," is checked"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Trigger entity type"),": ensure ",(0,o.yg)("strong",{parentName:"li"},"After an alert has been updated")," is checked"),(0,o.yg)("li",{parentName:"ul"},"Set ",(0,o.yg)("strong",{parentName:"li"},"Alert property")," to ",(0,o.yg)("strong",{parentName:"li"},"Value of: alert.eventCount")," and ",(0,o.yg)("strong",{parentName:"li"},"Change")," to ",(0,o.yg)("strong",{parentName:"li"},"Changes")),(0,o.yg)("li",{parentName:"ul"},"Under ",(0,o.yg)("strong",{parentName:"li"},"Condition sets"),", click the ",(0,o.yg)("strong",{parentName:"li"},"Add condition")," button and choose ",(0,o.yg)("strong",{parentName:"li"},"Alert property")),(0,o.yg)("li",{parentName:"ul"},"Under ",(0,o.yg)("strong",{parentName:"li"},"Alert properties")," set ",(0,o.yg)("strong",{parentName:"li"},"Property")," to ",(0,o.yg)("strong",{parentName:"li"},"Value of: alert.eventCount"),", ",(0,o.yg)("strong",{parentName:"li"},"Operator")," to ",(0,o.yg)("strong",{parentName:"li"},"greater or equal"),", ",(0,o.yg)("strong",{parentName:"li"},"Matches")," to ",(0,o.yg)("strong",{parentName:"li"},"only"),", and ",(0,o.yg)("strong",{parentName:"li"},"Value")," to ",(0,o.yg)("strong",{parentName:"li"},"Number: 1")),(0,o.yg)("li",{parentName:"ul"},"Scroll down to the section: ",(0,o.yg)("strong",{parentName:"li"},"Then take the following actions:")),(0,o.yg)("li",{parentName:"ul"},"Under ",(0,o.yg)("strong",{parentName:"li"},"Impact connection"),", select your Netcool/Impact integration"),(0,o.yg)("li",{parentName:"ul"},"Under ",(0,o.yg)("strong",{parentName:"li"},"Impact policy"),", select your Netcool/Impact housekeeping policy: ",(0,o.yg)("inlineCode",{parentName:"li"},"AIOPS_Housekeeping")),(0,o.yg)("li",{parentName:"ul"},"Under ",(0,o.yg)("strong",{parentName:"li"},"Impact policy parameter mapping options"),", select ",(0,o.yg)("strong",{parentName:"li"},"Send the full alert")),(0,o.yg)("li",{parentName:"ul"},"Scroll back up to the top of the page and click on the ",(0,o.yg)("strong",{parentName:"li"},"Create policy")," button")),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"You can check that the policy is firing by checking the ",(0,o.yg)("strong",{parentName:"p"},"Last run")," timestamp in the Automations Policies view:\n",(0,o.yg)("img",{src:n(41963).A,width:"1422",height:"101"}))),(0,o.yg)("h2",{id:"54-clear-the-events-in-netcoolomnibus"},"5.4: Clear the events in Netcool/OMNIbus"),(0,o.yg)("p",null,"Reset the event set in your system by clearing out all the old events in the source: Netcool/OMNIbus."),(0,o.yg)("p",null,"Open a command terminal, connect to the ObjectServer VM via SSH, and log in to the ObjectServer:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"ssh netcool@netcoolvm\n$OMNIHOME/bin/nco_sql -server AGG_P -user root -password netcool\n")),(0,o.yg)("p",null,"Copy and paste the following SQL into the SQL prompt:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"delete from alerts.status;\ngo\n")),(0,o.yg)("h2",{id:"55-view-the-alerts-viewer"},"5.5: View the Alerts viewer"),(0,o.yg)("p",null,"The final confirmation step is to log in to AIOps and inspect the ",(0,o.yg)("strong",{parentName:"p"},"Alerts viewer"),"."),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Log in to the AIOps console and select ",(0,o.yg)("strong",{parentName:"li"},"Alerts")," from the main menu"),(0,o.yg)("li",{parentName:"ul"},"FInd some alerts coming through from Netcool/OMNIbus"),(0,o.yg)("li",{parentName:"ul"},"Double-click one of the alerts and check that the ",(0,o.yg)("inlineCode",{parentName:"li"},"expirySeconds")," attribute is being set:\n",(0,o.yg)("img",{src:n(10018).A,width:"558",height:"298"}))))}y.isMDXComponent=!0},10018:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/expiry_seconds-694f05317881107fdae64c7fe9465162.png"},41963:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/housekeeping_policy-ceabd08e8ebd0619fceaad00c5c5d6de.png"}}]);