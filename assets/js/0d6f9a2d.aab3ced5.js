"use strict";(self.webpackChunkswat_hub=self.webpackChunkswat_hub||[]).push([[6527],{15680:(e,n,t)=>{t.d(n,{xA:()=>c,yg:()=>y});var a=t(96540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(t),m=r,y=u["".concat(l,".").concat(m)]||u[m]||d[m]||i;return t?a.createElement(y,o(o({ref:n},c),{},{components:t})):a.createElement(y,o({ref:n},c))}));function y(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[u]="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},12635:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=t(58168),r=(t(96540),t(15680));const i={title:"6. Exploring Instana",description:"Explore Instana",sidebar_position:7},o=void 0,s={unversionedId:"instana/opentelemetry/explore/index",id:"instana/opentelemetry/explore/index",title:"6. Exploring Instana",description:"Explore Instana",source:"@site/labs/instana/opentelemetry/6-explore/index.mdx",sourceDirName:"instana/opentelemetry/6-explore",slug:"/instana/opentelemetry/explore/",permalink:"/waiops-tech-jam/labs/instana/opentelemetry/explore/",draft:!1,editUrl:"https://github.com/IBM/waiops-tech-jam/tree/main/labs/instana/opentelemetry/6-explore/index.mdx",tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"6. Exploring Instana",description:"Explore Instana",sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"5. Web-application monitoring",permalink:"/waiops-tech-jam/labs/instana/opentelemetry/webapplication-monitoring/"},next:{title:"Quiz",permalink:"/waiops-tech-jam/labs/instana/opentelemetry/quiz/"}},l={},p=[{value:"Explore Instana and OpenTelemetry traces",id:"explore-instana-and-opentelemetry-traces",level:2},{value:"Instana native tracing",id:"instana-native-tracing",level:2},{value:"OpenTelemetry tracing",id:"opentelemetry-tracing",level:2},{value:"Instana and OpenTelemetry combined traces",id:"instana-and-opentelemetry-combined-traces",level:2},{value:"Instana native tracing - code examples",id:"instana-native-tracing---code-examples",level:2},{value:"OpenTelemetry tracing - code examples",id:"opentelemetry-tracing---code-examples",level:2}],c={toc:p},u="wrapper";function d(e){let{components:n,...i}=e;return(0,r.yg)(u,(0,a.A)({},c,i,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("admonition",{title:"Work In Progress",type:"warning"},(0,r.yg)("p",{parentName:"admonition"},"This lab is currently under development.")),(0,r.yg)("h2",{id:"explore-instana-and-opentelemetry-traces"},"Explore Instana and OpenTelemetry traces"),(0,r.yg)("p",null,"Now, once the Instana and OpenTelemetry Demo Application are in sync, you can\nstart exploring the captured data."),(0,r.yg)("h2",{id:"instana-native-tracing"},"Instana native tracing"),(0,r.yg)("p",null,"In this section you will focus on exploring Instana's native tracing\ncapabilities. In your Instana UI/Analytics search for calls which meet these\ncriteria:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Application name: your application name"),(0,r.yg)("li",{parentName:"ul"},"Service name: frontendproxy")),(0,r.yg)("p",null,"Click on the image call described under the point (4) from the below screen"),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"explore4",src:t(58451).A,width:"1497",height:"1116"})),(0,r.yg)("p",null,"On the right side of the screen you will notice tags and call parameters,\ntogether with an Infrastructure information - EnvoyProxy. This means that\nInstana injected its own tracing libraries into the proxy application."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"explore5",src:t(80966).A,width:"2141",height:"1169"})),(0,r.yg)("h2",{id:"opentelemetry-tracing"},"OpenTelemetry tracing"),(0,r.yg)("p",null,"Using Instana agent, you can also receive OpenTelemetry based traces. Let's find\nan example in your environment. Go to Instana UI/Analytics search for calls\nwhich meet these criteria:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Application name: your application name"),(0,r.yg)("li",{parentName:"ul"},"Service name: quoteservice")),(0,r.yg)("p",null,"Click on the call link to see the transaction details."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"explore6",src:t(95085).A,width:"1459",height:"987"})),(0,r.yg)("p",null,'In the detailed view of the call, please take a look at the right side of the\nscreen. You will find there a list of json attributes captured by Instana. One\nof them is called "telemetry.sdk.name" with a value "opentelemetry", which\nproves that the content is coming from the OpenTelemetry tracer.'),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"explore7",src:t(880).A,width:"2120",height:"1146"})),(0,r.yg)("h2",{id:"instana-and-opentelemetry-combined-traces"},"Instana and OpenTelemetry combined traces"),(0,r.yg)("p",null,"Instana can combine traces coming from applications instrumented by\nOpenTelemetry and Instana tracing on the same screen. Please follow the below\ninstructions to find an example of such transaction in your environment."),(0,r.yg)("p",null,"Go to Instana UI/Analytics and search for the calls that are in your application\nperspective and endpoint name is /api/cart like presented below. Click on\n/api/cart to see the details of the call."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"explore1",src:t(35052).A,width:"1804",height:"921"})),(0,r.yg)("p",null,"Click on the first transaction as highlighted on the below screen in a point\n(1). The point (2) represents the captured data. The content was delivered by a\nnative Instana tracing."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"explore2",src:t(13362).A,width:"1635",height:"960"})),(0,r.yg)("p",null,"Click on the second row within the transaction as described below in a point\n(1). The point (2) represents the captured data which comes from the\nOpenTelemetry tracer."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"explore3",src:t(7545).A,width:"1642",height:"953"})),(0,r.yg)("p",null,"The above example proves the Instana can combine traces from both OpenTelemetry\nand Instana tracing within the same screen under one transaction ID."),(0,r.yg)("h2",{id:"instana-native-tracing---code-examples"},"Instana native tracing - code examples"),(0,r.yg)("p",null,"Instana can provide combined traces from the OpenTelemetry and Instana native\ntracing. In the below example, you can see, how to use native Instana\ninstrumentation techniques. In the below snippet, we follow\n",(0,r.yg)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/instana-observability/current?topic=technologies-monitoring-envoy-proxy#configuring-distributed-tracing"},"Envoy tracing configuration described here")),(0,r.yg)("p",null,"As an outcome, Instana will inject its code and capture tracing of a calls,\nwhich were processed by the Envoy proxy."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'FROM envoyproxy/envoy:v1.25-latest\nRUN apt-get update && apt-get install -y gettext-base wget ca-certificates && apt-get clean && rm -rf /var/lib/apt/lists/*\n\nUSER envoy\nWORKDIR /home/envoy\nCOPY ./src/frontendproxy/envoy.tmpl.yaml envoy.tmpl.yaml\n\n# Instana tracing\nARG ARTI_PATH=\'https://artifact-public.instana.io/artifactory/shared/com/instana/libinstana_sensor/\'\nARG INSTANA_AGENT_KEY\nARG INSTANA_DOWNLOAD_KEY\nRUN access_key=$([ ! -z "${INSTANA_DOWNLOAD_KEY}" ] && echo "${INSTANA_DOWNLOAD_KEY}" || echo "${INSTANA_AGENT_KEY}") \\\n    && wget --user _ --password ${access_key} --output-document=./list.html ${ARTI_PATH} \\\n    && sensor_version=$(grep -o "href=\\"[0-9]\\+\\.[0-9]\\+\\.[0-9]\\+/\\"" ./list.html | tail -n1 | cut -d\'"\' -f2) \\\n    && echo "Using sensor version ${sensor_version}" \\\n    && wget --user _ --password ${access_key} --output-document=/home/envoy/libcxx-libinstana_sensor.so ${ARTI_PATH}${sensor_version}linux-amd64-libcxx-libinstana_sensor.so\n\nENTRYPOINT ["/bin/sh", "-c", "envsubst < envoy.tmpl.yaml > envoy.yaml && envoy -c envoy.yaml;"]\n')),(0,r.yg)("p",null,"Please note the use of libcxx-libinstana_sensor.so library."),(0,r.yg)("p",null,(0,r.yg)("a",{parentName:"p",href:"https://github.com/instana/opentelemetry-demo/blob/main/src/frontendproxy/Dockerfile"},"The source code is available here")),(0,r.yg)("h2",{id:"opentelemetry-tracing---code-examples"},"OpenTelemetry tracing - code examples"),(0,r.yg)("p",null,"If you wish to use OpenTelemetry in your application, here is the example\nsnippet which can show, how to build the proper instrumentation."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-php"},"use OpenTelemetry\\API\\Common\\Instrumentation\\Globals;\nuse OpenTelemetry\\API\\Trace\\Span;\nuse OpenTelemetry\\API\\Trace\\SpanKind;\nuse Psr\\Http\\Message\\ResponseInterface as Response;\nuse Psr\\Http\\Message\\ServerRequestInterface as Request;\nuse Slim\\App;\n\nfunction calculateQuote($jsonObject): float\n{\n    $quote = 0.0;\n    $childSpan = Globals::tracerProvider()->getTracer('manual-instrumentation')\n        ->spanBuilder('calculate-quote')\n        ->setSpanKind(SpanKind::KIND_INTERNAL)\n        ->startSpan();\n    $childSpan->addEvent('Calculating quote');\n\n    try {\n        if (!array_key_exists('numberOfItems', $jsonObject)) {\n            throw new \\InvalidArgumentException('numberOfItems not provided');\n        }\n        $numberOfItems = intval($jsonObject['numberOfItems']);\n        $quote = round(8.90 * $numberOfItems, 2);\n\n        $childSpan->setAttribute('app.quote.items.count', $numberOfItems);\n        $childSpan->setAttribute('app.quote.cost.total', $quote);\n\n        $childSpan->addEvent('Quote calculated, returning its value');\n    } catch (\\Exception $exception) {\n        $childSpan->recordException($exception);\n    } finally {\n        $childSpan->end();\n        return $quote;\n    }\n}\n\nreturn function (App $app) {\n    $app->post('/getquote', function (Request $request, Response $response) {\n        $span = Span::getCurrent();\n        $span->addEvent('Received get quote request, processing it');\n\n        $jsonObject = $request->getParsedBody();\n\n        $data = calculateQuote($jsonObject);\n\n        $payload = json_encode($data);\n        $response->getBody()->write($payload);\n\n        $span->addEvent('Quote processed, response sent back', [\n            'app.quote.cost.total' => $data\n        ]);\n\n        return $response\n            ->withHeader('Content-Type', 'application/json');\n    });\n};\n")),(0,r.yg)("p",null,"Please note the use of OpenTelemetry/API and further use of the span builders."),(0,r.yg)("p",null,(0,r.yg)("a",{parentName:"p",href:"https://github.com/instana/opentelemetry-demo/blob/main/src/quoteservice/app/routes.php"},"The source code can be found here")))}d.isMDXComponent=!0},13362:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/explore-001-fixed-a2a2524d60ee1d67b831f277bffe37f6.png"},7545:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/explore-002-fixed-b3a862fac127b090c778f634d570a160.png"},35052:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/explore-003-fixed-bdaf72cd4258c2f99cbf6b0173592741.png"},58451:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/explore-004-fixed-9404c5e5a82bfd3bb76b063b53c6caa7.png"},80966:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/explore-005-fixed-423741cbae155004ef538d08a429317b.png"},95085:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/explore-006-fixed-13e14173fd1e50704fb486e29d4484f1.png"},880:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/explore-007-fixed-d95ac2a21171f39e536039fa5f1d392c.png"}}]);