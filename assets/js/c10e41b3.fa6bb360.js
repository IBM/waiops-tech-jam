"use strict";(self.webpackChunkswat_hub=self.webpackChunkswat_hub||[]).push([[1930],{15680:(e,n,t)=>{t.d(n,{xA:()=>p,yg:()=>h});var a=t(96540);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=a.createContext({}),g=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=g(e.components);return a.createElement(l.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=r(e,["components","mdxType","originalType","parentName"]),c=g(t),m=o,h=c["".concat(l,".").concat(m)]||c[m]||u[m]||i;return t?a.createElement(h,s(s({ref:n},p),{},{components:t})):a.createElement(h,s({ref:n},p))}));function h(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,s=new Array(i);s[0]=m;var r={};for(var l in n)hasOwnProperty.call(n,l)&&(r[l]=n[l]);r.originalType=e,r[c]="string"==typeof e?e:o,s[1]=r;for(var g=2;g<i;g++)s[g]=t[g];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},87350:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>g});var a=t(58168),o=(t(96540),t(15680));const i={title:"4. Agent Installation",description:"How to install, configure and troubleshoot Instana agent",sidebar_position:5},s="Agent Installation",r={unversionedId:"instana/server-and-agent-install-lab/agent-installation/index",id:"instana/server-and-agent-install-lab/agent-installation/index",title:"4. Agent Installation",description:"How to install, configure and troubleshoot Instana agent",source:"@site/labs/instana/server-and-agent-install-lab/4-agent-installation/index.mdx",sourceDirName:"instana/server-and-agent-install-lab/4-agent-installation",slug:"/instana/server-and-agent-install-lab/agent-installation/",permalink:"/waiops-tech-jam/labs/instana/server-and-agent-install-lab/agent-installation/",draft:!1,editUrl:"https://github.com/IBM/waiops-tech-jam/tree/main/labs/instana/server-and-agent-install-lab/4-agent-installation/index.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"4. Agent Installation",description:"How to install, configure and troubleshoot Instana agent",sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"3. Instana Server Installation",permalink:"/waiops-tech-jam/labs/instana/server-and-agent-install-lab/server-installation/"},next:{title:"Quiz",permalink:"/waiops-tech-jam/labs/instana/server-and-agent-install-lab/quiz/"}},l={},g=[{value:"4.1: Instana Agent Deployment Options",id:"41-instana-agent-deployment-options",level:2},{value:"4.2: Installing a local Instana Agent on K3s for self monitoring",id:"42-installing-a-local-instana-agent-on-k3s-for-self-monitoring",level:2},{value:"4.3: Installing Instana Agent on a Linux VM",id:"43-installing-instana-agent-on-a-linux-vm",level:2},{value:"4.4: Installing Instana Agent on OpenShift Cluster",id:"44-installing-instana-agent-on-openshift-cluster",level:2},{value:"4.5: Installing Instana Agent in a Docker Environment",id:"45-installing-instana-agent-in-a-docker-environment",level:2},{value:"4.6: View Instana Agents in the Instana UI",id:"46-view-instana-agents-in-the-instana-ui",level:2},{value:"4.7: Troubleshooting Instana Agent Installation on Linux",id:"47-troubleshooting-instana-agent-installation-on-linux",level:2},{value:"4.8: Troubleshooting Instana Agent Installation on Kubernetes Cluster",id:"48-troubleshooting-instana-agent-installation-on-kubernetes-cluster",level:2},{value:"4.9: Configuring Proxy",id:"49-configuring-proxy",level:2},{value:"4.10: Configuring Instana Agent",id:"410-configuring-instana-agent",level:2},{value:"4.11: Agent Configuration Troubleshooting",id:"411-agent-configuration-troubleshooting",level:2},{value:"4.12: Configuring GitOps for Agents",id:"412-configuring-gitops-for-agents",level:2}],p={toc:g},c="wrapper";function u(e){let{components:n,...i}=e;return(0,o.yg)(c,(0,a.A)({},p,i,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"agent-installation"},"Agent Installation"),(0,o.yg)("h2",{id:"41-instana-agent-deployment-options"},"4.1: Instana Agent Deployment Options"),(0,o.yg)("p",null,"Instana has a variety of agent installation options including the mirror\nrepository and static agents that allow customers to meet strict change control\nprocesses. Some of the available options are listed below:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"OS specific installer (Linux, MacOS, Windows, UNIX)"),(0,o.yg)("li",{parentName:"ul"},"Container setup"),(0,o.yg)("li",{parentName:"ul"},"Docker (and other container managers)"),(0,o.yg)("li",{parentName:"ul"},"Kubernetes"),(0,o.yg)("li",{parentName:"ul"},"OpenShift"),(0,o.yg)("li",{parentName:"ul"},"Hosted Cloud Services"),(0,o.yg)("li",{parentName:"ul"},"Serverless component")),(0,o.yg)("p",null,"All above mentioned methods are accessible via the wizard on the Instana UI"),(0,o.yg)("admonition",{type:"caution"},(0,o.yg)("p",{parentName:"admonition"},"If you are unable to access the Instana Web UI you will need to go back through\nthe previous lab and follow all the steps to ensure that the Instana server is\nup and running.")),(0,o.yg)("p",null,"When installing Instana agent you have to select if you want the agent to be\n",(0,o.yg)("strong",{parentName:"p"},"dynamic")," or ",(0,o.yg)("strong",{parentName:"p"},"static")," based on whether it can update itself or not. Here is\nthe excerpt from the\n",(0,o.yg)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/SSE1JP5_current/src/pages/setup_and_manage/host_agent/index.html"},"Instana agent documentation"),"."),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},"A ",(0,o.yg)("strong",{parentName:"p"},"Dynamic")," host agent downloads the latest set of sensors from\nrepositories. By default, a dynamic agent updates itself at agent startup and checks daily for updates to the\nagent and sensor code. This automatically gives you access to new features and bug fixes.  It is also possible to tightly\ncontrol the updating of dynamic host agents by\n",(0,o.yg)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/instana-observability/current?topic=agents-configuring-updates-dynamic-host#version-pinning"},"pinning a version"),"\nIt is also possible to change the interval that the Agent checks for updates."),(0,o.yg)("p",{parentName:"li"},"By default, dynamic host agents use the Instana repository to pull updates,\nbut it is possible to\n",(0,o.yg)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/instana-observability/current?topic=agents-setting-up-agent-repositories-dynamic-host"},"set up your own managed mirror"),".\nCurrently, the mirror must be a Nexus or Artifactory repository. This is probably the best\noption for must customers because it allows them the benefits of automatic\nupdates, while at the same time controlling the content that is in the\nrepository.  In addition, it eliminates the need for every Agent to have internet access to the repositories.")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("p",{parentName:"li"},"A ",(0,o.yg)("strong",{parentName:"p"},"Static"),' host agent is a self-contained host agent that includes all the\nlatest available components at the time of its release, and has no dynamic\nupdate capabilities. The static host agent has a stable "bill of materials"\nthat never changes after the host agent\'s installation.  ',(0,o.yg)("strong",{parentName:"p"},"Static Agents")," must\nbe manually upgraded or upgraded via automation such as Ansible."))),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"Static host agents require no internet connection to the Instana repository, and\nare recommended in restrictive network setups.")),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"42-installing-a-local-instana-agent-on-k3s-for-self-monitoring"},"4.2: Installing a local Instana Agent on K3s for self monitoring"),(0,o.yg)("p",null,"Instana provides the ability to setup ",(0,o.yg)("strong",{parentName:"p"},"self monitoring")," of the ",(0,o.yg)("strong",{parentName:"p"},"Standard Edition"),"\nserver.  Self monitoring the Instana Backend when using the Standard Edition of Instana\ninstalled on K3s is very simple. During the installation, the Agent is automatically configured\nto monitor the key technologies such as cassandra, kafka, postgres, etc. so that the entire\nInstana backend server is being monitored."),(0,o.yg)("p",null,"Open a new terminal tab by selecting ",(0,o.yg)("strong",{parentName:"p"},"File")," -> ",(0,o.yg)("strong",{parentName:"p"},"New Tab"),"."),(0,o.yg)("p",null,"SSH to the Instana server with the ",(0,o.yg)("em",{parentName:"p"},"stanctl")," cli tool installed:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"ssh jammer@instana\n")),(0,o.yg)("p",null,"Become the root user:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"sudo su -\n")),(0,o.yg)("p",null,"Run the following command:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"stanctl agent apply\n")),(0,o.yg)("p",null,"After a short time you should see the following output:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"\u2839 Applying instana-agent  [5s] \u2713\n")),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"43-installing-instana-agent-on-a-linux-vm"},"4.3: Installing Instana Agent on a Linux VM"),(0,o.yg)("p",null,"We will start by installing the Instana Agent on the Linux VM that is running\nIBM MQ and ACE."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"architecture-agent-mqace-vm",src:t(16290).A,width:"991",height:"634"})),(0,o.yg)("p",null,"Open a new terminal tab by selecting ",(0,o.yg)("strong",{parentName:"p"},"File")," -> ",(0,o.yg)("strong",{parentName:"p"},"New Tab"),"."),(0,o.yg)("p",null,"SSH to the ACE/MQ server as follows:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"ssh jammer@mqace\n")),(0,o.yg)("p",null,"When prompted if you want to continue connecting, type: ",(0,o.yg)("inlineCode",{parentName:"p"},"yes")),(0,o.yg)("p",null,"Use sudo to switch to the root user:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"sudo -i\n")),(0,o.yg)("p",null,"After logging into Instana for the first time you will be taken to the Agent\nDeployment page."),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"If you aren't on the ",(0,o.yg)("strong",{parentName:"p"},"Agent deployment")," screen you can get there by selecting\nthe ",(0,o.yg)("strong",{parentName:"p"},"Home")," menu in the left navigation and then clicking the ",(0,o.yg)("strong",{parentName:"p"},'"Deploy\nAgent"')," button near the upper right corner."),(0,o.yg)("p",{parentName:"admonition"},(0,o.yg)("img",{src:t(35426).A,width:"2878",height:"422"}))),(0,o.yg)("p",null,"A list of different environments where you can install the Instana Agent is\nshown. For example, on Linux, you can choose a automatic ",(0,o.yg)("strong",{parentName:"p"},"one-liner"),"\ninstallation, RPM, or TAR file installation. For OpenShift/kubernetes, you have\nmultiple options including operator, helm, and yaml installs. The easiest method\nis the default, ",(0,o.yg)("strong",{parentName:"p"},'"Automatic Installation (One-Liner)"'),". The ",(0,o.yg)("em",{parentName:"p"},"MQACE")," VM is a\nLinux server, so select Linux (One-liner)."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"instana-default-login",src:t(94830).A,width:"2756",height:"1742"})),(0,o.yg)("p",null,"There are a few other options including the use of different java versions,\nstatic vs. dynamic agents, etc. Leave the default settings."),(0,o.yg)("p",null,"Next, select the checkbox next to ",(0,o.yg)("strong",{parentName:"p"},'"Install and start as service"'),". This will\nsetup the systemctl autostart process and will also start the Agent immediately\nafter it is installed."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"install command",src:t(57854).A,width:"2752",height:"1364"})),(0,o.yg)("p",null,"Finally, copy and paste the curl command into the ",(0,o.yg)("strong",{parentName:"p"},"root@mqace")," terminal window\nand answer ",(0,o.yg)("inlineCode",{parentName:"p"},"y")," when prompted."),(0,o.yg)("p",null,"At this point the Agent is installed and up and running. You can confirm this by\nrunning:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"ps -ef | grep instana\n")),(0,o.yg)("p",null,"You should see a process running, the short version looks like this:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"root       22012       1 99 12:35 ?        00:00:11 /opt/instana/agent/jvm/bin/java\n")),(0,o.yg)("p",null,"The Agent will automatically start monitoring the operating system and start\ndiscovering key processes and middleware. In many cases it will automatically\ninstrument those technologies. In the case of some technologies (eg. MQ an and\nApp Connect Enterprise), there are manual configuration steps required due to\nthe need to provide credentials for accessing those applications."),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"44-installing-instana-agent-on-openshift-cluster"},"4.4: Installing Instana Agent on OpenShift Cluster"),(0,o.yg)("p",null,"The next step is to install the Instana Agent into the ",(0,o.yg)("strong",{parentName:"p"},"Apps")," Sing Node\nOpenShift Cluster that in future labs we'll be using to host our demo\napplications ",(0,o.yg)("em",{parentName:"p"},"Robot Shop")," and ",(0,o.yg)("em",{parentName:"p"},"Quote of the Day"),"."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"architecture-agent-ocp",src:t(80559).A,width:"991",height:"634"})),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},'Throughout this lab, we will be using the "oc" command to run commands within\nOpenShift. The "oc" command is similar to kubectl for other versions of\nKubernetes. There are some minor syntax differences.')),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"Open another tab in your terminal")," so you are back on the local bastion host\n",(0,o.yg)("strong",{parentName:"p"},"admin@bastion-gym-lan"),"."),(0,o.yg)("p",null,"Check to make sure you are in the right place by running the following:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"cd ~\noc cluster-info --kubeconfig kubeconfig-apps\n")),(0,o.yg)("p",null,"You should see the following output, specifically the url\n",(0,o.yg)("inlineCode",{parentName:"p"},"https:api.sno.techzone.lan:6443"),". If you don't try opening a new tab or\nterminal window and trying again."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"check-cluster",src:t(30914).A,width:"1786",height:"102"})),(0,o.yg)("p",null,"Follow the steps below to install the Agent into the cluster:"),(0,o.yg)("p",null,"Set the correct cluster to use:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"export KUBECONFIG=~/kubeconfig-apps\n")),(0,o.yg)("p",null,"Set permissions for the Instana Agent to allow the Agent to have access to\nmonitor the entire cluster:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"oc adm policy add-scc-to-user privileged -z instana-agent --kubeconfig kubeconfig-apps\n")),(0,o.yg)("p",null,"From the ",(0,o.yg)("strong",{parentName:"p"},"Agent deployment")," screen select OpenShift, Helm chart from the list."),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"If you aren't on the ",(0,o.yg)("strong",{parentName:"p"},"Agent deployment")," screen you can get there by selecting\nthe ",(0,o.yg)("strong",{parentName:"p"},'"Stan"')," robot icon in the upper left corner and then clicking the\n",(0,o.yg)("strong",{parentName:"p"},'"Deploy Agent"')," button near the upper right corner."),(0,o.yg)("p",{parentName:"admonition"},(0,o.yg)("img",{src:t(35426).A,width:"2878",height:"422"}))),(0,o.yg)("p",null,(0,o.yg)("img",{src:t(28934).A,width:"2750",height:"1744"})),(0,o.yg)("p",null,"Provide a meaningful name for the Cluster and specify and Agent Zone. These namespace\nwill show up within the Instana UI:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Cluster name"),": ",(0,o.yg)("inlineCode",{parentName:"li"},"SNO")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Agent Zone"),": ",(0,o.yg)("inlineCode",{parentName:"li"},"Demo Apps"))),(0,o.yg)("p",null,(0,o.yg)("img",{src:t(60635).A,width:"696",height:"472"})),(0,o.yg)("p",null,"Setting these values will allow you to find your Agent and Kubernetes Cluster\nwithin the user interface and not get confused by data coming in from other\nagents."),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Zones are used to organize the Instana Agents (and sensors). Many customers\ncreate zones for lines of business, data center locations, public cloud regions,\netc")),(0,o.yg)("p",null,"Copy the command from the Instana Web UI and run it as the admin user on the\nbastion host."),(0,o.yg)("admonition",{title:"Copy & paste",type:"note"},(0,o.yg)("p",{parentName:"admonition"},"Be mindful when copying and pasting to ensure no extra lines are inserted by\nfirst copying the command to a text document.")),(0,o.yg)("p",null,"You will see output similar to what's shown below"),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"helm install",src:t(76529).A,width:"2276",height:"1266"})),(0,o.yg)("p",null,"Next, view a list of the pods that are running in the agent namespace. There\nwill be one pod for each worker node in your target cluster. This SNO cluster\nonly has one worker node so you will only see one pod running."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"oc get pods -n instana-agent --kubeconfig kubeconfig-apps\n")),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"running agent pods",src:t(4803).A,width:"1524",height:"222"})),(0,o.yg)("p",null,"This completes the installation of Instana agent on OpenShift cluster."),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"45-installing-instana-agent-in-a-docker-environment"},"4.5: Installing Instana Agent in a Docker Environment"),(0,o.yg)("admonition",{title:"Information Only",type:"warning"},(0,o.yg)("p",{parentName:"admonition"},"You do not need to perform the actions in this section. This is for your\ninformation only. It may be useful if you install Instana using the Classic\nmode.")),(0,o.yg)("p",null,"If you chose to run the Classic installation of Instana Server you might also\nwant to deploy an Instana Docker agent locally to self monitor the Instana\nBackend."),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"architecture-agent-mqace-vm",src:t(80433).A,width:"991",height:"634"})),(0,o.yg)("p",null,"You can navigate back to your first tab still logged into the ",(0,o.yg)("strong",{parentName:"p"},"instana")," host\nor from a terminal ssh to the Instana server again:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"ssh jammer@instana\n")),(0,o.yg)("p",null,"Switch to root"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"sudo -i\n")),(0,o.yg)("p",null,"In the Instana UI, from the ",(0,o.yg)("strong",{parentName:"p"},"Agent deployment")," screen select ",(0,o.yg)("strong",{parentName:"p"},"Docker")," this\ntime."),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"If you aren't on the ",(0,o.yg)("strong",{parentName:"p"},"Agent deployment")," screen you can get there by selecting\nthe ",(0,o.yg)("strong",{parentName:"p"},'"Stan"')," robot icon in the upper left corner and then clicking the\n",(0,o.yg)("strong",{parentName:"p"},'"Deploy Agent"')," button near the upper right corner."),(0,o.yg)("p",{parentName:"admonition"},(0,o.yg)("img",{src:t(35426).A,width:"2878",height:"422"}))),(0,o.yg)("p",null,(0,o.yg)("img",{src:t(35409).A,width:"2760",height:"1728"})),(0,o.yg)("p",null,"At the top of the page you will see an entry box where you can specify a\n",(0,o.yg)("strong",{parentName:"p"},"Zone"),". Specify a zone name such as ",(0,o.yg)("strong",{parentName:"p"},"TechZone"),". Then, copy the docker run\ncommand and paste it into the ",(0,o.yg)("strong",{parentName:"p"},"root@instana")," terminal window."),(0,o.yg)("p",null,(0,o.yg)("img",{src:t(93405).A,width:"2736",height:"1484"})),(0,o.yg)("p",null,"This will install the Instana Agent as a docker container running on the Instana\nServer machine."),(0,o.yg)("p",null,"Once complete you can issue a ",(0,o.yg)("strong",{parentName:"p"},"docker ps")," command, you'll see there is a new\nInstana agent container running."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"docker ps | grep agent\n")),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"docker ps agent",src:t(96129).A,width:"3502",height:"96"})),(0,o.yg)("p",null,"Once installed, the Agent will begin to collect host metrics and will discover\nthe various technologies like Cassandra, ClickHouse, ElasticSearch, Nginx,\nNode.js, and more. Many of these technologies will be monitored automatically\nwithout the need for configuration. In some cases, the sensors need to be\nconfigured in order to see the performance metrics."),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"46-view-instana-agents-in-the-instana-ui"},"4.6: View Instana Agents in the Instana UI"),(0,o.yg)("p",null,"From the left navigation select ",(0,o.yg)("strong",{parentName:"p"},"Infrastructure"),"."),(0,o.yg)("p",null,(0,o.yg)("img",{src:t(78428).A,width:"2288",height:"690"})),(0,o.yg)("p",null,"You should see 3 nodes reporting. The ",(0,o.yg)("strong",{parentName:"p"},"Instana VM"),", the ",(0,o.yg)("strong",{parentName:"p"},"MQACE VM")," and the\n",(0,o.yg)("strong",{parentName:"p"},"Single Node OpenShift (SNO) VM"),". If you don't see them yet, give the agents a\nfew minutes to start up."),(0,o.yg)("admonition",{type:"note"},(0,o.yg)("p",{parentName:"admonition"},"In an upcoming section we will learn how to update the name of the zone where\nthe ",(0,o.yg)("em",{parentName:"p"},"MQACE")," VM resides.")),(0,o.yg)("p",null,(0,o.yg)("img",{src:t(19066).A,width:"3474",height:"2324"})),(0,o.yg)("h2",{id:"47-troubleshooting-instana-agent-installation-on-linux"},"4.7: Troubleshooting Instana Agent Installation on Linux"),(0,o.yg)("p",null,"If you cannot see the ",(0,o.yg)("strong",{parentName:"p"},"Instana")," or ",(0,o.yg)("strong",{parentName:"p"},"MQACE")," hosts in the Instana UI you\nshould read the Instana agent logs on the respective agent host located at\n",(0,o.yg)("inlineCode",{parentName:"p"},"/opt/instana/agent/data/log/agent.log"),". Look for the current status and any\nwarnings or errors that may be shown."),(0,o.yg)("h2",{id:"48-troubleshooting-instana-agent-installation-on-kubernetes-cluster"},"4.8: Troubleshooting Instana Agent Installation on Kubernetes Cluster"),(0,o.yg)("p",null,"If you don't see the ",(0,o.yg)("strong",{parentName:"p"},"SNO host")," in the ",(0,o.yg)("strong",{parentName:"p"},"Demo Apps")," zone after a couple of\nminutes, you need to troubleshoot the Instana Agent."),(0,o.yg)("admonition",{title:"Important",type:"caution"},(0,o.yg)("p",{parentName:"admonition"},"The following must be done from a terminal window on the bastion host\n(",(0,o.yg)("strong",{parentName:"p"},"admin@bastion-gym-lan"),")")),(0,o.yg)("p",null,"Check to make sure that all pods are running. Since Instana agent runs as a\nDaemonSet the number of pods should be equal to number of nodes in your cluster,\nin this case one."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"oc get pods -n instana-agent --kubeconfig kubeconfig-apps\n")),(0,o.yg)("p",null,"You can check the Instana Agent pod logs by running:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"oc logs $(oc get pods -n instana-agent -o custom-columns=POD:.metadata.name --no-headers --kubeconfig kubeconfig-apps) -n instana-agent -c instana-agent --kubeconfig kubeconfig-apps\n")),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"49-configuring-proxy"},"4.9: Configuring Proxy"),(0,o.yg)("admonition",{title:"Information Only",type:"warning"},(0,o.yg)("p",{parentName:"admonition"},"This section is here for informational purposes. There are no steps to execute.")),(0,o.yg)("p",null,"If there is no direct connectivity for the Instana agent you may need to setup a\nproxy. There are 2 connections with 2 different locations for configuration:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Connection to ",(0,o.yg)("strong",{parentName:"li"},"Instana Backend")," - defined in\n",(0,o.yg)("em",{parentName:"li"},"INSTANA-AGENT-DIR"),"/etc/instana/com.instana.agent.main.sender.Backend.cfg"),(0,o.yg)("li",{parentName:"ul"},"Connection to ",(0,o.yg)("strong",{parentName:"li"},"Agent/Sensor Repository")," - defined in\n",(0,o.yg)("em",{parentName:"li"},"INSTANA-AGENT-DIR"),"/etc/mvn-settings.xml (This is used in case client wants to\nsetup internal maven2 mirror repository)")),(0,o.yg)("p",null,"Proxy configuration goes into the respective files. You can also use\n",(0,o.yg)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/obi/current?topic=requirements-installing-host-agent-docker#agent-configuration"},"environment variables")),(0,o.yg)("p",null,"For backend connectivity you have to define ",(0,o.yg)("em",{parentName:"p"},"INSTANA",(0,o.yg)("em",{parentName:"em"},"AGENT_PROXY"))," variables.\nFor repository connectivity you have to define ",(0,o.yg)("em",{parentName:"p"},"INSTANA",(0,o.yg)("em",{parentName:"em"},"REPOSITORY_PROXY")),"\nvariables."),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"410-configuring-instana-agent"},"4.10: Configuring Instana Agent"),(0,o.yg)("admonition",{title:"Information Only",type:"warning"},(0,o.yg)("p",{parentName:"admonition"},"This section is here for informational purposes. There are no steps to execute.")),(0,o.yg)("p",null,"There are multiple ways to configure the Instana agent. These instructions apply\nto the Instana Agent installed on a traditional server. Instructions would be\ndifferent for docker or kubernetes versions of the Agent. Settings related to\nagent functionality reside in ",(0,o.yg)("inlineCode",{parentName:"p"},"configuration.yaml")," file located by default in\n",(0,o.yg)("inlineCode",{parentName:"p"},"/opt/instana/agent/etc/instana")," directory. However, other settings related to\nagent environment sits in other ","*",".cfg files."),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Agent will actually read and use ANY yaml file in that directory.")),(0,o.yg)("p",null,"Some customers choose to have separate yaml files for each key technology. For\nexample, you could create a mq.yaml file and an ace.yaml file in the same\ndirectory and it would read both files. ",(0,o.yg)("inlineCode",{parentName:"p"},"configuration.yaml")," will contain sample\nconfiguration entries and comments for ALL available sensors at the time of your\ninstall, ",(0,o.yg)("strong",{parentName:"p"},"BUT")," it will not automatically add new sensor config as new sensors\nbecome available."),(0,o.yg)("p",null,"For host based installation you can update ",(0,o.yg)("inlineCode",{parentName:"p"},"configuration.yaml")," and agent should\npick up changes automatically (no restart required). "),(0,o.yg)("p",null,"For Kubernetes based installations, you can specify the same content that would go\ninto the configuration.yaml file, but the mechanism is different.  See the product documentation\nfor Operator and yaml based installations.  For helm installs, you use an ",(0,o.yg)("strong",{parentName:"p"},"agent.configuration_yaml"),"\nparameter to reference a values.yaml file.   The configuration information would be placed in\nthe values.yaml file. Yaml content can be placed directly in the helm command, but\nthe syntax gets a little tricky.  Here is an example helm command:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sh"},"helm install instana-agent \\\n  --repo https://agents.instana.io/helm \\\n  --namespace instana-agent \\\n  --set agent.key=wxyz  \\\n  --set agent.downloadKey=abcdefg \\\n  --set agent.endpointHost=agent-acceptor.instana2.tivlab.raleigh.ibm.com  \\\n  --set agent.endpointPort=443 \\\n  --set zone.name=zone1 \\\n  --set cluster.name='cluster1' \\\n  --set agent.configuration_yaml=\"$(cat values.yaml)\" \\\n  --set k8s_sensor.deployment.enabled=true \\\n  --set k8s_sensor.deployment.replicas=2 \\\n  instana-agent\n")),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Instana agent configuration file must be a proper YAML - if your changes are not\napplied, make sure that it's not a formatting error")),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"411-agent-configuration-troubleshooting"},"4.11: Agent Configuration Troubleshooting"),(0,o.yg)("admonition",{title:"Information Only",type:"warning"},(0,o.yg)("p",{parentName:"admonition"},"This section is here for informational purposes. There are no steps to execute.")),(0,o.yg)("p",null,"The first place to look when the agent does not start properly or does not work\nas expected is agent log file. By default it is located in\n",(0,o.yg)("inlineCode",{parentName:"p"},"/opt/instana/agent/data/log/agent.log")," . This is the path for a traditional\nserver."),(0,o.yg)("p",null,"In case of Kubernetes based deployment you have to look at logs of\n",(0,o.yg)("inlineCode",{parentName:"p"},"instana-agent")," pods running in ",(0,o.yg)("inlineCode",{parentName:"p"},"instana-agent")," namespace."),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"412-configuring-gitops-for-agents"},"4.12: Configuring GitOps for Agents"),(0,o.yg)("admonition",{title:"Information Only",type:"warning"},(0,o.yg)("p",{parentName:"admonition"},"This section is here for informational purposes. There are no steps to execute.")),(0,o.yg)("p",null,"If you don't want to modify the Instana agent configuration files for each agent\nlocally, you can setup a centralized git repository for configuration files and\ninstruct Instana agent to use these files. To accomplish that, follow the steps\nfrom the\n",(0,o.yg)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/instana-observability/current?topic=agents-git-based-configuration-management"},"documentation"),"."),(0,o.yg)("p",null,"The Instana agent fetches configuration updates from the remote repository:"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},"Upon the startup or restart."),(0,o.yg)("li",{parentName:"ol"},"Through a reboot initiated over the Agent Management Dashboard."),(0,o.yg)("li",{parentName:"ol"},"Through a configuration change over the Agent Management Dashboard."),(0,o.yg)("li",{parentName:"ol"},"Through the Web API as described in the Host Agent section and the\nintegrations that rely on it like the GitHub Update Agent action.")),(0,o.yg)("hr",null),(0,o.yg)("p",null,"You have now completed the Instana Server and Agent installation lab.  Feel free\nto explore the other Instana Jam-in-a-Box labs that available on TechZone."))}u.isMDXComponent=!0},93405:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/agent-deploy-docker-config-d0cc871a6607f8bd40b072351a07ba2a.png"},35409:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/agent-deploy-docker-093117c15ffc4dfa20ab3c5e75b8b77b.png"},28934:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/agent-deploy-ocp-helm-52d74c4bba7bfcf983ba23a2a1dd1fed.png"},94830:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/agent-deployment-bd6b6c3d920fe6629a4c99b74bbf0def.png"},80433:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/architecture-agent-instana-vm-4d1ef1204211ed543a8835fb8d62e9d5.png"},16290:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/architecture-agent-mqace-vm-c8bfafe85823f18ed396041480c85cb8.png"},80559:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/architecture-agent-ocp-795490db044457bbf1a458f3792645ad.png"},30914:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/check-cluster-2a5c30fbc00ebbfb7106b0179278ff95.png"},60635:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/clusterZone-4a28ce24ca814bc90cede3f5960a8c48.png"},35426:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/deploy-agent-7736569c89e6bf0719a591f466a75353.png"},96129:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/docker-ps-agent-4720cda98e2e9213de5858c9e0809d36.png"},76529:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/helm-install-c03c9883f62a508d91c0f65b15eacea7.png"},78428:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/infrastructure-menu-25629f3358fbabffa2d0c6d4eba18a58.png"},57854:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/install-command-3e832fa982c0e7fa9fb7e50b2e6b4a16.png"},4803:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/ocp-agent-running-8cf74e6d46b7578fcc8fd6ce4092c0ed.png"},19066:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/show-three-vms-f8a2882bf5cb5ad38820fd520ddfeed2.png"}}]);