<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-practitioner-basics/storage/data-foundation/maintenance">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Reclaiming Free Space | IBM AIOps Automation SWAT</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://github.com/waiops-tech-jam/labs/practitioner-basics/storage/data-foundation/maintenance/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Reclaiming Free Space | IBM AIOps Automation SWAT"><meta data-rh="true" name="description" content="Guidance for maintenaning your storage cluster over time."><meta data-rh="true" property="og:description" content="Guidance for maintenaning your storage cluster over time."><link data-rh="true" rel="icon" href="/waiops-tech-jam/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://github.com/waiops-tech-jam/labs/practitioner-basics/storage/data-foundation/maintenance/"><link data-rh="true" rel="alternate" href="https://github.com/waiops-tech-jam/labs/practitioner-basics/storage/data-foundation/maintenance/" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/waiops-tech-jam/labs/practitioner-basics/storage/data-foundation/maintenance/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/waiops-tech-jam/blog/rss.xml" title="IBM AIOps Automation SWAT RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/waiops-tech-jam/blog/atom.xml" title="IBM AIOps Automation SWAT Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7WTTHT6SEH"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-7WTTHT6SEH",{anonymize_ip:!0})</script><link rel="stylesheet" href="/waiops-tech-jam/assets/css/styles.f87e0e6c.css">
<link rel="preload" href="/waiops-tech-jam/assets/js/runtime~main.bf944562.js" as="script">
<link rel="preload" href="/waiops-tech-jam/assets/js/main.df3d1d6f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/waiops-tech-jam/"><div class="navbar__logo"><img src="/waiops-tech-jam/img/ibm-watson-logo.png" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/waiops-tech-jam/img/ibm-watson-logo.png" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">IBM SWAT</b></a><a class="navbar__item navbar__link" href="/waiops-tech-jam/labs/jam-in-a-box/">Labs</a><a class="navbar__item navbar__link" href="/waiops-tech-jam/blog/">Guides</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/IBM/waiops-tech-jam" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/waiops-tech-jam/labs/jam-in-a-box/">Jam-in-a-Box</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/waiops-tech-jam/labs/practitioner-basics/">Practitioner Basics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Practitioner Basics&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/waiops-tech-jam/labs/practitioner-basics/solution-design/architecture/">1. Solution Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/waiops-tech-jam/labs/practitioner-basics/cluster-design/node-sizing/">2. Cluster Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/waiops-tech-jam/labs/practitioner-basics/storage/intro/">3. Storage</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/waiops-tech-jam/labs/practitioner-basics/storage/intro/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/waiops-tech-jam/labs/practitioner-basics/storage/data-foundation/planning/">Data Foundation</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/waiops-tech-jam/labs/practitioner-basics/storage/data-foundation/planning/">Planning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/waiops-tech-jam/labs/practitioner-basics/storage/data-foundation/maintenance/">Reclaiming Free Space</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/waiops-tech-jam/labs/practitioner-basics/monitoring/configuring-self-monitoring/">4. Self monitoring</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/waiops-tech-jam/labs/instana/introduction/">Instana Labs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/waiops-tech-jam/labs/turbonomic/introduction/">Turbonomic Labs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/waiops-tech-jam/labs/cloud-pak-aiops/introduction/">Cloud Pak for AIOps Labs</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/waiops-tech-jam/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/waiops-tech-jam/labs/practitioner-basics/"><span itemprop="name">Practitioner Basics</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">3. Storage</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Data Foundation</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Reclaiming Free Space</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Reclaiming free space on block devices</h1><p>This section focuses on the importance of reclaiming free blocks after delete
operations periodically to avoid running out of capacity unnecessarily.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tldr">TL;DR<a href="#tldr" class="hash-link" aria-label="Direct link to TL;DR" title="Direct link to TL;DR">​</a></h2><p>Following deletion operations, freed blocks are not immediately reclaimed and
returned to the underlying block storage pool. Freed blocks need to be reclaimed
as part of a normal and healthy operations regime to maintain accurate and
efficient capacity utilization.</p><p>Understanding the need for the capacity reclamation process and configuring
appropriate schedules to reclaim freed blocks will help ensure applications are
not suddenly impacted due to loss of storage capacity.</p><p>See <a href="https://docs.redhat.com/en/documentation/red_hat_openshift_data_foundation/4.14/html/managing_and_allocating_storage_resources/reclaiming-space-on-target-volumes_rhodf#reclaiming-space-on-target-volumes_rhodf" target="_blank" rel="noopener noreferrer">Reclaiming space on target volumes</a> for guidance on how to
configure <code>fstrim</code> jobs to help maintain healthy capacity utilization of your
storage cluster.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-block-device-rbd-capacity-behaviour">Understanding block device (RBD) capacity behaviour<a href="#understanding-block-device-rbd-capacity-behaviour" class="hash-link" aria-label="Direct link to Understanding block device (RBD) capacity behaviour" title="Direct link to Understanding block device (RBD) capacity behaviour">​</a></h2><p>In production environments, the recommended storage devices are enterprise grade
SSD or NVMe drives for best performance and resiliency.</p><p>When configuring underlying storage in a software-defined-storage (SDS)
solution, it can be common practice to leverage thin-provisioning for efficiency
and utilization.</p><p>When thin-provisioned, disk space is allocated based on data needs instead of
preallocation upfront. As a result, the block storage controller has more work
to do in maintaining the underlying blocks, e.g. managing which blocks have been
freed and reclaiming them for reuse in other storage requests.</p><p>To understand this, let&#x27;s consider a simple scenario of what happens when an
application requests block storage using a Persistent Volume Claim (PVC) with
dynamic provisioning via a <code>StorageClass</code> in filesystem mode:</p><ol><li><p>On receiving a PVC request in a thin-provisioned storage solution, a
Persistent Volume (PV) is created in the underlying block storage pool,
formatted with the requested filesystem, and mounted onto the node(s) where
the consuming Pods are scheduled to run.</p></li><li><p>The application running in the associated Pod(s) read, write and delete data
as needed.</p></li><li><p>When data is deleted within the filesystem, whilst it may appear free for
reuse within the context of the PV&#x27;s filesystem, the underlying block storage
pool is not aware the associated blocks are actually free yet.</p></li><li><p>As new writes occur, it can be the case that new blocks from the underlying
storage pool are allocated. This can happen for many reasons and is typically
transparent to the filesystem within the PV.</p></li></ol><p>When files are deleted from a filesystem within a PV, the occupied space is not
released and returned immediately to the underlying block storage pool. Which
can lead to a discrepancy between the actual used space reported by the
filesystem inside the PV, and the space reported by the underlying storage
platform, in this case Ceph.</p><p>The process used to reclaim unused space in the underlying block storage pool
devices is known as <code>fstrim</code>:</p><ul><li>It essentially informs the underlying storage pool about blocks no longer in
use, allowing Ceph to reclaim the space.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-happens-if-unused-space-is-not-reclaimed-periodically">What happens if unused space is not reclaimed periodically?<a href="#what-happens-if-unused-space-is-not-reclaimed-periodically" class="hash-link" aria-label="Direct link to What happens if unused space is not reclaimed periodically?" title="Direct link to What happens if unused space is not reclaimed periodically?">​</a></h2><p>The immediate affect is the storage solution cannot report accurately on
utilized disk space, which can lead to:</p><ul><li>A capacity threshold warning alerts being triggered at <code>75%</code> full capacity.</li><li>A capacity threshold critical alert being triggered when capacity usage
crosses <code>85%</code>:<ul><li>This leads to the storage cluster going into <code>read-only</code> mode for data
protection until the situation is resolved.</li></ul></li></ul><p>So whilst the application and filesystem inside the PV may <em>think</em> they have
available capacity from the filesystem perspective, the underlying storage
solution thinks it is running out of capacity, until blocks marked to be freed
are actually reclaimed.</p><p>If the storage cluster goes into <code>read-only</code> mode, or backing devices begin to
experience instability related problems, the application relying on the storage
will be negatively impacted, potentially going down completely.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Increased writes and deletes can accelerate overall capacity usage.</div><div class="admonitionContent_S0QG"><p>In periods of increased write activity, underlying block consumption can be
accelerated if new writes outstrip deletes and block reclamation.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-dont-i-need-to-manually-run-fstrim-in-a-normal-linux-server-environment">Why don&#x27;t I need to manually run <code>fstrim</code> in a normal Linux server environment?<a href="#why-dont-i-need-to-manually-run-fstrim-in-a-normal-linux-server-environment" class="hash-link" aria-label="Direct link to why-dont-i-need-to-manually-run-fstrim-in-a-normal-linux-server-environment" title="Direct link to why-dont-i-need-to-manually-run-fstrim-in-a-normal-linux-server-environment">​</a></h2><p>In a normal Linux (normal being a standard, non-Kubernetes server environment)
system which uses <code>systemd</code>, <code>fstrim</code> is normally configured to run weekly as a
<code>timer</code> job.</p><p>On a <code>systemd</code> based Linux server that has an SSD or NVMe drive, you can list
the active timers using:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl list-timers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should see output like below:</p><p><img loading="lazy" alt="Systemd fstrim timer" src="/waiops-tech-jam/assets/images/systemd-fstrim-timer-a323d228605866875308c6128ba1357a.png" width="1954" height="360" class="img_ev3q"></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Configuration can vary between Linux distributions.</div><div class="admonitionContent_S0QG"></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-else-can-impact-capacity-utilization">What else can impact capacity utilization?<a href="#what-else-can-impact-capacity-utilization" class="hash-link" aria-label="Direct link to What else can impact capacity utilization?" title="Direct link to What else can impact capacity utilization?">​</a></h2><p>As mentioned above, write and delete heavy usage patterns at the filesystem
level can impact how quickly capacity usage grows, especially during periods of
high writes, like a data storm for example.</p><p>But application data isn&#x27;t the only thing that consumes capacity from the
underlying storage pool. The storage solution itself has to maintain metadata it
uses to manage the storage cluster.</p><p>As data volume increases, so does the metadata. In situations where there are
frequent writes or deletes, metadata can accumulate over time, particularly if
the storage solution is not configured to reclaim free blocks after deletions at
an optimum frequency.</p><p>This all contributes to overall capacity usage of the usable storage pool.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-frequently-should-fstrim-be-run">How frequently should <code>fstrim</code> be run?<a href="#how-frequently-should-fstrim-be-run" class="hash-link" aria-label="Direct link to how-frequently-should-fstrim-be-run" title="Direct link to how-frequently-should-fstrim-be-run">​</a></h2><p>This depends on several factors, including application workload filesytem usage
patterns. In most cases every <code>24 hours</code> may be sufficient.</p><p>However, in cases where there are substantial writes and deletions at fairly
rapid or frequent rates, more aggressive <code>fstrim</code> frequency may be required.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Consider performance impacts of running too frequently.</div><div class="admonitionContent_S0QG"><p>It is always advisable to seek advice from storage subject matter experts and
test the impact of frequency changes in a pre-production environment before
making changes in production.</p></div></div><p>The current recommended approach is to monitor for <code>CephClusterNearFull</code> alerts
which by default occur at <code>75%</code> utilization:</p><ul><li>Take action to add capacity or use it as guidance to work out the frequency of
running <code>fstrim</code> to reclaim space.</li></ul><p>An additional proactive approach would be to leverage Prometheus metrics to
understand how fast PVs may be filling up:</p><ul><li>It could be the case that there is a data storm causing the capacity
utilization to go up faster than normal:<ul><li>Leveraging rate calculations as part of the overall monitoring strategy will
help provide better forward guidance.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="keeping-an-eye-on-application-storage-configuration-changes">Keeping an eye on application storage configuration changes<a href="#keeping-an-eye-on-application-storage-configuration-changes" class="hash-link" aria-label="Direct link to Keeping an eye on application storage configuration changes" title="Direct link to Keeping an eye on application storage configuration changes">​</a></h2><p>From time to time, based on application and usage requirements, there can be a
need to increase Persistent Volume Claim (PVC) capacity requests.</p><p>It is imporant to remember that in a highly abstracted system such as Kubernetes
/ OpenShift, coupled with Software-Defined-Solutions (SDS) such as IBM Storage
Fusion Data Foundation or OpenShift Data Foundation, the storage solution will
not be inherently aware of increases in overall application capacity
requirements. The storage solution will keep attempting to service storage
requests until it runs out of capacity.</p><p>It is highly advisable to introduce a careful change management process which
includes reviewing any changes to PVC requirements and whether more storage
capacity is required as a result.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-configure-fstrim">How do I configure <code>fstrim</code>?<a href="#how-do-i-configure-fstrim" class="hash-link" aria-label="Direct link to how-do-i-configure-fstrim" title="Direct link to how-do-i-configure-fstrim">​</a></h2><p>This typically requires annotating the target PVCs with a schedule frequency.</p><p>It is highly advisable to review the documentation fully and testing in a
pre-production environment before making changes in production.</p><p>Refer to the <a href="https://docs.redhat.com/en/documentation/red_hat_openshift_data_foundation/4.14/html/managing_and_allocating_storage_resources/reclaiming-space-on-target-volumes_rhodf#reclaiming-space-on-target-volumes_rhodf" target="_blank" rel="noopener noreferrer">Red Hat OpenShift Data Foundation</a> documentation
for detailed instructions on the procedure.</p><hr></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/IBM/waiops-tech-jam/tree/main/labs/practitioner-basics/3-storage/data-foundation/maintenance.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/waiops-tech-jam/labs/practitioner-basics/storage/data-foundation/planning/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Planning</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/waiops-tech-jam/labs/practitioner-basics/monitoring/configuring-self-monitoring/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configuring self-monitoring</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tldr" class="table-of-contents__link toc-highlight">TL;DR</a></li><li><a href="#understanding-block-device-rbd-capacity-behaviour" class="table-of-contents__link toc-highlight">Understanding block device (RBD) capacity behaviour</a></li><li><a href="#what-happens-if-unused-space-is-not-reclaimed-periodically" class="table-of-contents__link toc-highlight">What happens if unused space is not reclaimed periodically?</a></li><li><a href="#why-dont-i-need-to-manually-run-fstrim-in-a-normal-linux-server-environment" class="table-of-contents__link toc-highlight">Why don&#39;t I need to manually run <code>fstrim</code> in a normal Linux server environment?</a></li><li><a href="#what-else-can-impact-capacity-utilization" class="table-of-contents__link toc-highlight">What else can impact capacity utilization?</a></li><li><a href="#how-frequently-should-fstrim-be-run" class="table-of-contents__link toc-highlight">How frequently should <code>fstrim</code> be run?</a></li><li><a href="#keeping-an-eye-on-application-storage-configuration-changes" class="table-of-contents__link toc-highlight">Keeping an eye on application storage configuration changes</a></li><li><a href="#how-do-i-configure-fstrim" class="table-of-contents__link toc-highlight">How do I configure <code>fstrim</code>?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.ibm.com/docs/en/cloud-paks/cloud-pak-watson-aiops" target="_blank" rel="noopener noreferrer" class="footer__link-item">CP4AIOps<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.ibm.com/docs/en/noi/" target="_blank" rel="noopener noreferrer" class="footer__link-item">NOI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.ibm.com/docs/en/obi/current" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instana<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.turbonomic.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Turbonomic<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.ibm.com/au-en" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBM<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/waiops-tech-jam/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/IBM/waiops-tech-jam" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/waiops-tech-jam/assets/js/runtime~main.bf944562.js"></script>
<script src="/waiops-tech-jam/assets/js/main.df3d1d6f.js"></script>
</body>
</html>