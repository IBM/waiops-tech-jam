---
title: 7. Vulnerability Patching
description: 
  Discusses how to patch vulnerabilities in the sample application.
sidebar_position: 7
---

## 7.1: Overview

In this lab, we will demonstrate how to patch vulnerabilities in the sample application deployed in the previous section.
We will focus on addressing the `zlib` package vulnerability (CVE-2022-37434) in the finding related to the
qotd-engraving-service container image. 
After patching the vulnerability, we will run the Jenkins pipelines to build, deploy and scan the updated container image.
Finally, we will verify that the vulnerability has been resolved in Concert and that the related issue in GitHub has been closed.

:::note
In order to simplify the lab steps, we have skipped the proper steps to remediate a GitHub issue.
In a real-world scenario, you would typically create a new branch, make the code changes, and create a **pull request** to merge the changes into the main branch.
This **pull request** would reference the open GitHub issue and include details about the code changes made to address the vulnerability.
Finally, somebody else would review and **approve** the **pull request** before merging it or **reject** it if the changes are not satisfactory.
:::


## 7.2: Patching Vulnerabilities

In this section, we will provide an example on how to patch vulnerabilities in the sample application.
We will focus on addressing the `zlib` package vulnerability (CVE-2022-37434) in the
qotd-engraving-service container image.

Login to your GitHub account and open the following repository URL on the browser

````
concert-vulnerability-lab/qotd/qotd-engraving-service/
````

Open the `Dockerfile` in the `qotd-engraving-service` directory and click on the edit icon (pencil icon) to edit the file as shown below:

![](./images/edit-dockerfile.png)

Add the line below after the first line in the Dockerfile to update the Alpine packages to the latest version.

````
RUN apk update && apk upgrade --available
````
Your **Dockerfile** code should look like below. The only change is adding the line after the **From node:...** line in the **Dockerfile**.

```Dockerfile
FROM node:14.16.0-alpine

RUN apk update && apk upgrade --available

RUN apk add --update curl && \
    rm -rf /var/cache/apk/*

RUN mkdir /app
WORKDIR /app

COPY LICENSE .
COPY README.md .
COPY package.json .
COPY build.txt .
COPY ./*.js ./

RUN apk add --no-cache python3 make g++
RUN npm config set @quote-of-the-day:registry=https://gitlab.com/api/v4/projects/32433382/packages/npm/
RUN npm install

EXPOSE 3006

CMD ["node", "--expose-gc", "app.js"]
```


Click on the **Commit changes...** button on the top-right to commit the changes to the repository.
On the "Commit changes" dialog, select the **Commit directly to the main branch** option and click on the **Commit changes** button.

![](./images/commit-changes.png)


## 7.3: Running the Pipelines after Patching

Now that we have patched the vulnerability in the Dockerfile, we will run the pipelines to build, deploy and scan the updated container image.

From the Bastion Remote Desktop, open the Firefox browser and click on the Jenkins bookmark. On the 
*Sign in to Jenkins* page, enter **admin** as Username and the password found in the credentials file under 
*jenkins_password* and click **Sign in**.

On the Jenkins dashboard, click on the play button on the right corresponding to the **Build and Deploy** pipeline. 
Follow the execution progress. After this pipeline completes successfully, click on the play button on the 
right corresponding to the **Vulnerability Scan** pipeline and follow the execution progress.

![](./images/jenkins-pipelines.png)


## 7.4: Verifying the Vulnerability Resolution in Concert

After the both pipelines completed successfully, Concert received the updated vulnerability scan results and automatically updated the finding related to the
qotd-engraving-service container image.

From the Bastion Remote Desktop, open the Firefox browser and click on the Concert bookmark to open the Concert UI.
Login to the Concert UI with the credentials recorded in the credentials file (**concert_username:** and **concert_password:**).

From the left navigation menu, click on **Dimension -> Vulnerability**. Click on the **Highest risk score of this finding** to sort the vulnerabilities by risk score.
Note that the number of finding for CVE-2022-37434 changed from siz to five as shown below:

![](./images/vulnerability-resolved.png)


## 7.5: Verifying Issue Resolution in GitHub

Now go back to the GitHub repository page where you edited the Dockerfile. Click on the **Issues** tab.
Note that the number of **Open** issues is now 17 (refresh the page if needed). Click on **Closed** to view the closed issue related to **CVE-2022-37434** in qotd-engraving-service

![](./images/github-closed-issues.png)

Open the closed issue to view the details. You can see that the issue was automatically closed by Concert due to the fact that 
the vulnerability **CVE-2022-37434** does not affect the finding on qotd-engraving-service anymore.

![](./images/github-issue-details.png)



================================
===================================

# Congratulations! You have completed the Lab

================================
===================================

